<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    <meta name="description" content="Hexo Theme Redefine">
    <meta name="author" content="萧">
    <link rel="canonical" href="http://example.com/2023/07/29/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" />
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-redefine.png">
    <link rel="icon" type="image/png" href="/images/redefine-logo.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/redefine-logo.svg">
    <link rel="shortcut icon" href="/images/redefine-logo.svg">
    
    <title>
        
            常用的设计模式 |
        
        等想好起什么名字后再来改
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/css/fonts.css">

    
    <link rel="preconnect" href="https://evan.beee.top" crossorigin>
    <script id="hexo-configurations">
    let REDEFINE = window.REDEFINE || {};
    REDEFINE.hexo_config = {"hostname":"example.com","root":"/","language":"en"};
    REDEFINE.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#005080","avatar":"/images/redefine-avatar.svg","favicon":"/images/redefine-logo.svg","article_img_align":"center","right_side_width":"210px","content_max_width":"1000px","nav_color":{"left":"#f78736","right":"#367df7","transparency":35},"hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"background_image":{"light":"https://evan.beee.top/img/wallhaven-wqery6-light.webp","dark":"https://evan.beee.top/img/wallhaven-wqery6-dark.webp"},"title_color":{"light":"#fff","dark":"#d1d1b6"},"description":"Theme Redefine"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":false,"preload":true},"code_block":{"copy":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"0.5.2","friend_links":{"columns":2}};
    REDEFINE.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
    
    
<link rel="stylesheet" href="/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/css/brands.min.css">

    
<link rel="stylesheet" href="/css/solid.min.css">

    
<link rel="stylesheet" href="/css/regular.min.css">

    
    
    
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">
    
    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                等想好起什么名字后再来改
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="pc">
                <ul class="menu-list">
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        主页
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        存档记录
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories"  >
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        分类
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-link"></i>
                                        
                                        快捷链接&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/link2">LINK2
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a href="/link3">LINK3
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                主页
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="" 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                存档记录
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="" 
                        href="/categories"  >
                             
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                分类
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-link"></i>
                                
                                快捷链接&nbsp;<i class="fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="/link2">LINK2</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="/link3">LINK3</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">
            <div class="article-title">
                <span class="title-hover-animation"><h1 style="font-size:2rem; font-weight: bold; margin: 10px 0;">常用的设计模式</h1></span>
            </div>

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/redefine-avatar.svg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">萧</span>
                            
                                <span class="author-label">lol</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="pc">2023-07-29 08:13:24</span>
        <span class="mobile">2023-07-29 08:13</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <h1 id="OO设计原则"><a href="#OO设计原则" class="headerlink" title="OO设计原则"></a>OO设计原则</h1><blockquote>
<p>将应用中会变化的那部分取出并封装起来。这样可以使代码变化引起的意外影响变少，使系统更有弹性</p>
</blockquote>
<blockquote>
<p>针对接口编程，而不是针对实现编程</p>
</blockquote>
<blockquote>
<p>多用组合，少用继承</p>
</blockquote>
<p>代码复用性，扩展性，维护性<br>每当设计代码实现后，想想该业务在未来可能发生的变化，然后分析现在的代码在业务需求变化后好不好进行扩展</p>
<h1 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>策略模式是一种行为型模式，定义了算法簇，分别封装起来，让它们之间可以互相替换【可以理解为将对象和行为分开，行为定义为一个行为接口和若干具体行为的实现】。此模式让算法的变化独立于使用算法的客户。通过使用策略模式，可以在运行时根据需要选择不同的算法，而不需要修改客户端代码。</p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>取自《Head First设计模式》</p>
<blockquote>
<p>现在有一个业务需求，设计鸭子类，具体的鸭子类都继承于一个鸭子超类Duck,Duck中封装好了所有鸭子都一样的行为。而现在，不同种类的鸭子在<code>飞行</code>和<code>鸭叫</code>这两个行为上表现不一样。比如绿头鸭用扇动翅膀飞行，嘎嘎嘎叫；玩具鸭不能飞行，吱吱吱叫；火箭鸭靠火箭推动器飞行，不会叫</p>
</blockquote>
<p><strong>分析过程</strong></p>
<p>【运用继承+多态】<br>将fly()和quack()放入Duck，让每一个具体的鸭子继承Duck。若有需要，则在子类中重写这两个方法，覆盖Duck中原来的方法，从而实现每种鸭子都有自己特定的行为。这样的做法会有以下问题：<br>① 每次有新种类的鸭子，都要检查，看是否需要重写覆盖超类继承来的fly()和quack()。比如，玩具鸭不会飞行，那它就要重写覆盖继承来的fly()，使其什么都不做；另外还要重写覆盖继承来的quack()，使其有吱吱叫的鸭叫声(超类是嘎嘎嘎叫)<br>② 代码在多个子类中重复<br>③ 运行时的行为不容易改变<br>④ 很难得知所有鸭子的全部行为<br>⑤ 改变会牵一发而动全身，造成其他鸭子不想要的改变：比如未来还要引入一个“说人话”行为，那所有鸭子都会继承到这个行为，但是并不是所有鸭子都会“说人话”，那岂不是要给这些鸭子子类都进行重写覆盖？改动就很大了。</p>
<hr>
<p>既然继承会那么多问题，那就用接口。<br>Flyable接口中有fly()行为，Quackable接口中有quack()行为。每种鸭子都继承自Duck，根据会不会飞&#x2F;叫，来决定是否实现Flyable&#x2F;Quackable接口（这就避免了不会飞的鸭子有fly()行为…不合理的情况），根据自己行为的特点，在类中实现fly()&#x2F;quack()。这样的做法仍然不理想：<br>接口不具有实现代码，因此继承接口代码无法达到代码复用：某个行为需求变化了，那就要追踪到每个定义了该行为的实现类中去修改它，类一多，工作量就很大，而且可能造成新的错误</p>
<hr>
<p>发现总是因为可能发生的变化(新需求的到来)而导致代码存在缺陷(某些代码要改)，那么运用OO原则：</p>
<blockquote>
<p>找出应用中可能会发生变化的那部分，取出并封装起来，将变与不变分开</p>
</blockquote>
<p>fly()和quack()会随着鸭子种类的不同而变化，因此将这两个行为从Duck中抽出来，分别形成各自的一组类来实现各自的动作（比如fly行为有一个类实现“扇动翅膀飞行”，一个类实现“不能飞行”，一个类实现“依靠火箭推动器飞行”…）</p>
<p>但是仅仅这么做还是不够弹性，不能在创建鸭子的时候指定特定的飞行&#x2F;叫行为给它，即无法在运行时动态地改变鸭子的行为（行为在编写代码的时候，通过直接继承行为类已经写死了）</p>
<p>要实现运行时可以动态修改行为，那还要运用到以下OO原则：</p>
<blockquote>
<p>针对接口编程，而不是针对实现编程</p>
</blockquote>
<p>用接口FlyBehavior和QuackBehavior表示行为，制造一组行为类来实现这些接口。将这两个接口放入Duck，每种鸭子在继承Duck后，都可以继承到这两个接口。在创建具体鸭子的时候，通过构造函数将接口行为指定为对应的行为类。通过set方法，就可以在运行时动态地改变行为。这个做法是一个很大的突破：<br>无论是第一种方法：继承+多态，还是第二种方法：子类直接实现接口，都是依赖于“实现”，将实现绑死在鸭子的子类中，没法改变行为；而现在，鸭子的子类使用接口所表示的行为，具体的实现是在行为类中，鸭子不知道行为的实现细节。</p>
<p>每一个鸭子都“有一个”FlyBehavior和QuackBehavior，鸭子的行为不是继承  来的，而是和适当的行为对象组合来的，这也符合了OO原则：</p>
<blockquote>
<p>多用组合，少用继承。(“有一个”可能比“是一个”更好)</p>
</blockquote>
<p><strong>代码实现</strong><br>Duck抽象类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Duck</span> &#123;</span><br><span class="line">    <span class="comment">//鸭子共有的，不变的属性，行为全部省略</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//针对接口编程，用接口而不是某个特定实现类</span></span><br><span class="line">    <span class="comment">//这两个行为是会变化的，抽离出Duck，通过对象组合在Duck中</span></span><br><span class="line">    Flyable flyable;</span><br><span class="line">    Quackable quackable;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">//将行为委托给行为类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performFly</span><span class="params">()</span>&#123;</span><br><span class="line">        flyable.fly();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performQuack</span><span class="params">()</span>&#123;</span><br><span class="line">        quackable.quack();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//设定set方法，使得可以运行时动态改变行为</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFlyable</span><span class="params">(Flyable fb)</span>&#123;</span><br><span class="line">        flyable=fb;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setQuackable</span><span class="params">(Quackable qa)</span> &#123;</span><br><span class="line">        quackable=qa;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>飞行行为接口</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Flyable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>鸭叫接口</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Quackable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">quack</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>翅膀飞行实现类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlyWithWings</span> <span class="keyword">implements</span> <span class="title class_">Flyable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;扇动翅膀飞行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>不会飞行实现类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlyNoWay</span> <span class="keyword">implements</span> <span class="title class_">Flyable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;不会飞行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>靠火箭推动器飞行实现类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlyUseRocket</span> <span class="keyword">implements</span> <span class="title class_">Flyable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;靠火箭推动器飞行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>嘎嘎嘎叫实现类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuackGa</span> <span class="keyword">implements</span> <span class="title class_">Quackable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quack</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;嘎嘎嘎叫&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>不会叫实现类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuackNoWay</span> <span class="keyword">implements</span> <span class="title class_">Quackable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quack</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;不会叫&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>吱吱吱叫实现类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuackZhi</span> <span class="keyword">implements</span> <span class="title class_">Quackable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quack</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;吱吱叫&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>绿头鸭</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GreenHeadDuck</span> <span class="keyword">extends</span> <span class="title class_">Duck</span>&#123;</span><br><span class="line">    <span class="comment">//构造函数实例化的时候，将两个接口行为创建为实现类（针对接口编程）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GreenHeadDuck</span><span class="params">()</span>&#123;</span><br><span class="line">        flyable = <span class="keyword">new</span> <span class="title class_">FlyWithWings</span>();</span><br><span class="line">        quackable = <span class="keyword">new</span> <span class="title class_">QuackGa</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是绿头鸭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>玩具鸭</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlayDuck</span> <span class="keyword">extends</span> <span class="title class_">Duck</span>&#123;</span><br><span class="line">    <span class="comment">//构造函数实例化的时候，将两个接口行为创建为实现类（针对接口编程）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PlayDuck</span><span class="params">()</span>&#123;</span><br><span class="line">        flyable = <span class="keyword">new</span> <span class="title class_">FlyNoWay</span>();</span><br><span class="line">        quackable = <span class="keyword">new</span> <span class="title class_">QuackZhi</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是玩具鸭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>火箭鸭</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RocketDuck</span> <span class="keyword">extends</span> <span class="title class_">Duck</span>&#123;</span><br><span class="line">    <span class="comment">//构造函数实例化的时候，将两个接口行为创建为实现类（针对接口编程）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RocketDuck</span><span class="params">()</span>&#123;</span><br><span class="line">        flyable = <span class="keyword">new</span> <span class="title class_">FlyUseRocket</span>();</span><br><span class="line">        quackable = <span class="keyword">new</span> <span class="title class_">QuackNoWay</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是火箭鸭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>测试</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Duck</span> <span class="variable">greenHeadDuck</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GreenHeadDuck</span>();</span><br><span class="line">        <span class="type">Duck</span> <span class="variable">playDuck</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PlayDuck</span>();</span><br><span class="line">        <span class="type">Duck</span> <span class="variable">rocketDuck</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RocketDuck</span>();</span><br><span class="line">        <span class="comment">//测试</span></span><br><span class="line">        greenHeadDuck.display();</span><br><span class="line">        greenHeadDuck.performFly();</span><br><span class="line">        greenHeadDuck.performQuack();</span><br><span class="line">        System.out.println(<span class="string">&quot;************&quot;</span>);</span><br><span class="line">        playDuck.display();</span><br><span class="line">        playDuck.performFly();</span><br><span class="line">        playDuck.performQuack();</span><br><span class="line">        System.out.println(<span class="string">&quot;************&quot;</span>);</span><br><span class="line">        rocketDuck.display();</span><br><span class="line">        rocketDuck.performFly();</span><br><span class="line">        rocketDuck.performQuack();</span><br><span class="line">        <span class="comment">//测试：运行时动态修改火箭鸭的行为</span></span><br><span class="line">        rocketDuck.setFlyable(<span class="keyword">new</span> <span class="title class_">FlyNoWay</span>());</span><br><span class="line">        System.out.print(<span class="string">&quot;糟糕，燃料用完了，&quot;</span>);</span><br><span class="line">        rocketDuck.performFly();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>测试结果</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">我是绿头鸭</span><br><span class="line">扇动翅膀飞行</span><br><span class="line">嘎嘎嘎叫</span><br><span class="line">************</span><br><span class="line">我是玩具鸭</span><br><span class="line">不会飞行</span><br><span class="line">吱吱叫</span><br><span class="line">************</span><br><span class="line">我是火箭鸭</span><br><span class="line">靠火箭推动器飞行</span><br><span class="line">不会叫</span><br><span class="line">糟糕，燃料用完了，不会飞行</span><br></pre></td></tr></table></figure></div>

<h1 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h1><h2 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h2><p>观察者模式运用十分广泛，是JDK中使用最多的模式之一</p>
<p>观察者模式定义了被观察者subject和观察者observer的一对多的依赖(映射关系)，当subject里的内容更新后，会notify通知它的所有observer，observer收到通知后会自动更新</p>
<p><strong>类图</strong><br>每个被观察者必须实现subject接口</p>
<table>
<thead>
<tr>
<th>&lt; interface&gt;</br>Subject</th>
</tr>
</thead>
<tbody><tr>
<td>registerObserver()</br>notifyObserver()</br>removeObserver()</td>
</tr>
</tbody></table>
<p>每个观察者必须实现Observer接口</p>
<table>
<thead>
<tr>
<th>&lt; interface&gt;</br>Observer</th>
</tr>
</thead>
<tbody><tr>
<td>update()</td>
</tr>
</tbody></table>
<h2 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h2><p>取自《Head First 设计模式》</p>
<blockquote>
<p>气象观测站可以获取湿度，温度，气压。气象站那边提供WeatherData对象取得气象数据，目前的需求是建立一个应用，利用这个WeatherData对象拿到数据，并更新到三个显示装置上，分别是：目前状况，气象统计和天气预报。<br>WeatherData类中有getTemperatura()，getHumidity()，getPressure()方法和一些我们不需要知道细节也不能改动的方法。要求是实现measurementsChanged()方法，该方法会在气象数据更新的时候被自动调用</p>
</blockquote>
<p><strong>分析过程</strong></p>
<p>最简单粗暴地想到<br>将三个不同的显示装置封装成三个类，在measurementsChanged()中用get方法将最新的湿度，温度，气压数据拿到，然后这三个显示装置类分别调用自己的update(temp,humidity,pressure)方法进行更新并展示数据。这样实现显然有问题：<br>① 针对具体实现编程，而非针对接口编程。这使得以后增加&#x2F;删除显示装置时，都要对measurementsChanged()方法进行修改<br>② 无法在运行时动态地增加&#x2F;删除显示装置<br>③ 没有封装改变的部分</p>
<hr>
<p>采用观察者模式<br>创建被观察者Subject接口和观察者Observer接口。WeatherData类实现Subject接口，三个显示装置类分别实现Observer接口。在measurementsChanged()中，调用notifyObserver()方法通知所有观察者（这个方法中，遍历观察者，逐一调用自己的update方法）<br>另外，由于每个显示装置的display()都不同，可以将展示行为定义为接口</p>
<p><strong>代码实现</strong><br>被观察者Subject接口</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyObserver</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>观察者Observer接口</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">float</span> temp,<span class="type">float</span> humidity,<span class="type">float</span> pressure)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>显示装置显示数据接口</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Display</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>WeatherData</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//WeatherData是被观察者，需要实现Subject接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeatherData</span> <span class="keyword">implements</span> <span class="title class_">Subject</span>&#123;</span><br><span class="line">    <span class="comment">//其他属性，行为全部省略</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//气象站观测的三个数据</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> pressure;</span><br><span class="line">    <span class="comment">//引入一个观察者set集合，存放所有注册的观察者</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Observer&gt; observerSet;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WeatherData</span><span class="params">()</span>&#123;</span><br><span class="line">        observerSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实现被观察者Subject接口的三个方法：注册，通知，删除</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        observerSet.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyObserver</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//通知每个观察者，调用它们的update方法</span></span><br><span class="line">        <span class="keyword">for</span> (Observer ob:observerSet) &#123;</span><br><span class="line">            ob.update(temperature,humidity,pressure);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        observerSet.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//一旦气象站数据更新，就会自动调用这个方法（为啥会这样不用管）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">measurementsChanged</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//数据一旦更新，就通知所有的观察者</span></span><br><span class="line">        notifyObserver();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//允许运行时手动更新气象数据，模拟气象站获得新数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMeasurements</span><span class="params">(<span class="type">float</span> temp, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span>&#123;</span><br><span class="line">        <span class="comment">//更新数据</span></span><br><span class="line">        temperature = temp;</span><br><span class="line">        <span class="built_in">this</span>.humidity = humidity;</span><br><span class="line">        <span class="built_in">this</span>.pressure = pressure;</span><br><span class="line">        <span class="comment">//更新数据后，触发方法</span></span><br><span class="line">        measurementsChanged();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>实时数据显示装置</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实时显示装置是观察者，需要实现Observer接口（这是自己写的，不是java内置的那个）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CurrentShow</span> <span class="keyword">implements</span> <span class="title class_">Observer</span>,Display &#123;</span><br><span class="line">    <span class="comment">//显示装置需要显示的三个数据</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> pressure;</span><br><span class="line">    <span class="comment">//引入观察对象-被观察者（为了进行观察者注册，删除）</span></span><br><span class="line">    <span class="keyword">private</span> Subject weatherData;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数需要Subject对象，用来注册</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CurrentShow</span><span class="params">(Subject weatherData)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.weatherData = weatherData;</span><br><span class="line">        <span class="comment">//注册为观察者</span></span><br><span class="line">        weatherData.registerObserver(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">float</span> temp, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span> &#123;</span><br><span class="line">        <span class="comment">//显示实时数据，只需更新为最新数据即可</span></span><br><span class="line">        temperature = temp;</span><br><span class="line">        <span class="built_in">this</span>.humidity = humidity;</span><br><span class="line">        <span class="built_in">this</span>.pressure = pressure;</span><br><span class="line">        <span class="comment">//在这个简单例子中，值变化时候就调用display()很合理。但其实有更好的方式调用它</span></span><br><span class="line">        display();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;当前气象情况：实时温度为&quot;</span>+temperature</span><br><span class="line">                +<span class="string">&quot;C，实时湿度为&quot;</span>+humidity+<span class="string">&quot;%，实时气压为&quot;</span>+pressure);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>统计数据显示装置</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//气象统计显示装置是观察者，需要实现Observer接口（这是自己写的，不是java内置的那个）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatisticsShow</span> <span class="keyword">implements</span> <span class="title class_">Observer</span>,Display &#123;</span><br><span class="line">    <span class="comment">//显示装置需要显示的三个数据</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> pressure;</span><br><span class="line">    <span class="comment">//引入观察对象-被观察者（为了进行观察者注册，删除）</span></span><br><span class="line">    <span class="keyword">private</span> Subject weatherData;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数需要Subject对象，用来注册</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StatisticsShow</span><span class="params">(Subject weatherData)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.weatherData = weatherData;</span><br><span class="line">        <span class="comment">//注册为观察者</span></span><br><span class="line">        weatherData.registerObserver(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">float</span> temp, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span> &#123;</span><br><span class="line">        <span class="comment">//显示统计数据，为了方便，统计max即可</span></span><br><span class="line">        temperature = Math.max(temperature, temp);</span><br><span class="line">        <span class="built_in">this</span>.humidity = Math.max(<span class="built_in">this</span>.humidity, humidity);</span><br><span class="line">        <span class="built_in">this</span>.pressure = Math.max(<span class="built_in">this</span>.pressure, pressure);</span><br><span class="line">        <span class="comment">//在这个简单例子中，值变化时候就调用display()很合理。但其实有更好的方式调用它</span></span><br><span class="line">        display();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;截止至最新数据的统计气象情况：最高温度为&quot;</span>+temperature</span><br><span class="line">                +<span class="string">&quot;C，最高湿度为&quot;</span>+humidity+<span class="string">&quot;%，最大气压为&quot;</span>+pressure);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>天气预报显示装置</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//天气预报显示装置是观察者，需要实现Observer接口（这是自己写的，不是java内置的那个）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ForecastShow</span> <span class="keyword">implements</span> <span class="title class_">Observer</span>,Display &#123;</span><br><span class="line">    <span class="comment">//显示装置需要显示的三个数据</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> pressure;</span><br><span class="line">    <span class="comment">//引入观察对象-被观察者（为了进行观察者注册，删除）</span></span><br><span class="line">    <span class="keyword">private</span> Subject weatherData;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数需要Subject对象，用来注册</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ForecastShow</span><span class="params">(Subject weatherData)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.weatherData = weatherData;</span><br><span class="line">        <span class="comment">//注册为观察者</span></span><br><span class="line">        weatherData.registerObserver(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">float</span> temp, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span> &#123;</span><br><span class="line">        <span class="comment">//更新预测数据，为了方便，就取平均值为预测值</span></span><br><span class="line">        temperature = (temperature+temp)/<span class="number">2</span>;</span><br><span class="line">        <span class="built_in">this</span>.humidity = (<span class="built_in">this</span>.humidity+humidity)/<span class="number">2</span>;</span><br><span class="line">        <span class="built_in">this</span>.pressure = (<span class="built_in">this</span>.pressure+pressure)/<span class="number">2</span>;</span><br><span class="line">        <span class="comment">//在这个简单例子中，值变化时候就调用display()很合理。但其实有更好的方式调用它</span></span><br><span class="line">        display();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;根据最新气象数据，预计接下来三小时的天气：预测温度为&quot;</span>+temperature</span><br><span class="line">                +<span class="string">&quot;C，预测湿度为&quot;</span>+humidity+<span class="string">&quot;%，预测气压为&quot;</span>+pressure);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>测试启动气象站应用</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeatherApp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">WeatherData</span> <span class="variable">weatherData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WeatherData</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建显示装置，传入被观察者,进行观察者注册</span></span><br><span class="line">        <span class="type">CurrentShow</span> <span class="variable">currentShow</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">CurrentShow</span>(weatherData);</span><br><span class="line">        <span class="type">StatisticsShow</span> <span class="variable">statisticsShow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StatisticsShow</span>(weatherData);</span><br><span class="line">        <span class="type">ForecastShow</span> <span class="variable">forecastShow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForecastShow</span>(weatherData);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//手动设置更新，模拟气象站测量到新的数据</span></span><br><span class="line">        weatherData.setMeasurements(<span class="number">25</span>,<span class="number">65</span>,<span class="number">30</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;*********************&quot;</span>);</span><br><span class="line">        weatherData.setMeasurements(<span class="number">20</span>,<span class="number">50</span>,<span class="number">40</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;*********************&quot;</span>);</span><br><span class="line">        weatherData.setMeasurements(<span class="number">15</span>,<span class="number">95</span>,<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>测试结果</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">当前气象情况：实时温度为25.0C，实时湿度为65.0%，实时气压为30.0</span><br><span class="line">根据最新气象数据，预计接下来三小时的天气：预测温度为12.5C，预测湿度为32.5%，预测气压为15.0</span><br><span class="line">截止至最新数据的统计气象情况：最高温度为25.0C，最高湿度为65.0%，最大气压为30.0</span><br><span class="line">*********************</span><br><span class="line">当前气象情况：实时温度为20.0C，实时湿度为50.0%，实时气压为40.0</span><br><span class="line">根据最新气象数据，预计接下来三小时的天气：预测温度为16.25C，预测湿度为41.25%，预测气压为27.5</span><br><span class="line">截止至最新数据的统计气象情况：最高温度为25.0C，最高湿度为65.0%，最大气压为40.0</span><br><span class="line">*********************</span><br><span class="line">当前气象情况：实时温度为15.0C，实时湿度为95.0%，实时气压为20.0</span><br><span class="line">根据最新气象数据，预计接下来三小时的天气：预测温度为15.625C，预测湿度为68.125%，预测气压为23.75</span><br><span class="line">截止至最新数据的统计气象情况：最高温度为25.0C，最高湿度为95.0%，最大气压为40.0</span><br></pre></td></tr></table></figure></div>

<h2 id="Java内置API"><a href="#Java内置API" class="headerlink" title="Java内置API"></a>Java内置API</h2><p>java.util包提供了Observeral类和Observer接口，被观察者继承Observeral类，观察者实现Observer接口</p>
<p>Observeral类的类图</p>
<table>
<thead>
<tr>
<th>&lt; class&gt;</br>Observeral</th>
</tr>
</thead>
<tbody><tr>
<td>addObserver()</br>notifyObservers()</br>notifyObservers(Object arg)</br>deleteObserver()</br>setChanged()</td>
</tr>
</tbody></table>
<p>Observer接口的类图</p>
<table>
<thead>
<tr>
<th>&lt; interface&gt;</br>Observer</th>
</tr>
</thead>
<tbody><tr>
<td>update(Observable o, Object arg)</td>
</tr>
</tbody></table>
<h1 id="装饰者模式"><a href="#装饰者模式" class="headerlink" title="装饰者模式"></a>装饰者模式</h1><h2 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h2><p>装饰者模式是在不改变现有对象结构的前提下，动态地将责任(额外功能)附加到对象上，提供了比继承更加弹性的替代方案。属于结构型模式</p>
<p>通常构成如下<br>① <strong>Component</strong>（抽象组件）：它是具体组件和抽象装饰类的共同父类，声明了在具体组件中实现的业务方法，它的引入可以使客户端以一致的方式处理未被装饰的对象以及装饰之后的对象，实现客户端的透明操作。</p>
<p>② <strong>ConcreteComponent</strong>（具体组件）：它是抽象组件类的子类，用于定义具体的组件对象，实现了在抽象组件中声明的方法，装饰器可以给它增加额外的职责（方法）。</p>
<p>③ <strong>Decorator</strong>（抽象装饰类）：它也是抽象组件类的子类，用于给具体组件增加职责，但是具体职责在其子类中实现。它维护一个指向抽象组件对象的引用，通过该引用可以调用装饰之前组件对象的方法，并通过其子类扩展该方法，以达到装饰的目的。</p>
<p>④ <strong>ConcreteDecorator</strong>（具体装饰类）：它是抽象装饰类的子类，负责向组件添加新的职责。每一个具体装饰类都定义了一些新的行为，它可以调用在抽象装饰类中定义的方法，并可以增加新的方法用以扩充对象的行为。</p>
<p><img src="https://image.itbaima.net/images/253/image-20230902162676573.png" alt="pic/装饰者模式类图.png"></p>
<p>由于具体组件类和装饰类都实现了相同的抽象组件接口，因此装饰模式以对客户透明的方式动态地给一个对象附加上更多的责任，换言之，客户端并不会觉得对象在装饰前和装饰后有什么不同。装饰模式可以在不需要创造更多子类的情况下，将对象的功能加以扩展。</p>
<blockquote>
<p>Decorator继承于Beverage，似乎违反OO原则的少用继承。但事实上，装饰者和被装饰者必须是同一类型，也就是有同一超类，因此在这里，继承是为了达到“类型匹配”，而非“获得行为”。</p>
<p>当装饰者与组件(被装饰者)组合时，就是在加入新行为，这个新行为不是来自超类，而是由组合对象得来。正是使用对象组合，使得装饰者和被装饰者更有弹性地混合与匹配，而且是在运行时。<br>除此之外，可以在任何时候，实现新的装饰者添加新行为，如果依赖继承，每有新行为，都要改代码</p>
</blockquote>
<p>装饰模式的核心在于抽象装饰类的设计。</p>
<h2 id="例子-2"><a href="#例子-2" class="headerlink" title="例子"></a>例子</h2><p>取自《Head First 设计模式》</p>
<blockquote>
<p>开一家饮品店，主要有咖啡，奶茶，果汁三种饮品。顾客还可以在此基础上添加各种调料，比如奶泡，冰块，摩卡等。因此对于每种不同的组合，cost()方法得出的结果是不同的。<br>给出饮料抽象类Beverage，要求可以对每种组合，通过cost()算出正确的结果</p>
</blockquote>
<table>
<thead>
<tr>
<th>&lt; abstract class&gt;</br>Beverage</th>
</tr>
</thead>
<tbody><tr>
<td>description &#x2F;&#x2F;由每个子类设置，用来描述饮料</br></td>
</tr>
<tr>
<td>getDescription(Object arg)</br>cost() &#x2F;&#x2F;抽象方法，子类必须定义自己的实现</td>
</tr>
</tbody></table>
<p><strong>分析过程</strong></p>
<p>最简单粗暴的想法<br>对于每一种可能的组合，都给出一个继承于Beverage的实体类，cost()按照所选饮品和配料计算价钱。这个方法显然不行，搞出来的类太多了</p>
<hr>
<p>利用实例变量追踪调料+继承<br>Beverage抽象类中添加表示是否添加该调料的布尔变量，用has方法判断是否添加该调料，用set方法添加调料，抽象类中的cost()根据将调料为true的加在一起，子类覆盖超类cost()时，只需调用超类的cost()再加上本身饮品的价格即可。这样的做法有以下问题：<br>① 每次新增&#x2F;删除调料时都要增&#x2F;删Beverage的对于方法，并修改cost()<br>② 调料价格改变，cost()又要修改<br>③ 比如未来新增“茶”饮品，不适合“奶泡”调料，但仍会继承hasWhip()方法，显然不合适<br>④ 如果顾客要双倍奶泡，似乎很难应对</p>
<p>很显然，上面的做法违反了开闭原则</p>
<blockquote>
<p>类应该对扩展开放，对修改关闭</p>
</blockquote>
<p>开闭原则的目标是让类更加弹性，可以在不修改现有代码的前提下，就可搭配新的行为(拓展)</p>
<hr>
<p>采用装饰者模式</p>
<p>Beverage抽象类：相当于抽象组件Component，是具体组件和抽象装饰类的共同父类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">description</span> <span class="operator">=</span> <span class="string">&quot;未点餐&quot;</span>;</span><br><span class="line">    <span class="comment">//这个方法在抽象类中实现即可，具体饮料类直接用（但调料类需要进行覆盖）</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span>&#123;<span class="keyword">return</span> description;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//cost()方法设置为抽象方法，让子类实现各自的算法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>Coffee咖啡类：相当于具体组件ConcreteComponent，被装饰者，装饰器可以给它增加额外的职责（方法）</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//饮料类直接继承自Beverage抽象类，单点咖啡10元</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Coffee</span> <span class="keyword">extends</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Coffee</span><span class="params">()</span>&#123;description = <span class="string">&quot;咖啡&quot;</span>;&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>MilkTea奶茶类：相当于具体组件ConcreteComponent，被装饰者，装饰器可以给它增加额外的职责（方法）</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//饮料类直接继承自Beverage抽象类，单点奶茶8元</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MilkTea</span> <span class="keyword">extends</span> <span class="title class_">Beverage</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MilkTea</span><span class="params">()</span>&#123;description = <span class="string">&quot;奶茶&quot;</span>;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>CondimentDecorator抽象类：相当于抽象装饰类Decorator，它也是抽象组件类的子类，用于给具体组件增加职责，但是具体职责在其子类中实现</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调料抽象类：需让CondimentDecorator可以取代Beverage，所以继承于Beverage</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CondimentDecorator</span> <span class="keyword">extends</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line">    <span class="comment">//设置为抽象方法，所有调料类都必须重新实现该方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">getDescription</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>Whip奶盖类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调料类继承于CondimentDecorator，而它又继承于Beverage</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Whip</span> <span class="keyword">extends</span> <span class="title class_">CondimentDecorator</span>&#123;</span><br><span class="line">    <span class="comment">/*引用一个Beverage，它就是被装饰者(饮料)，需要将被装饰者记录在装饰者中*/</span></span><br><span class="line">    Beverage beverage;</span><br><span class="line">    <span class="comment">//被装饰者(饮料)通过构造函数传参，给到beverage，将饮料记录到实例变量中</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Whip</span><span class="params">(Beverage beverage)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.beverage = beverage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//利用委托的方式得到一个饮料描述，然后再追加调料描述</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> beverage.getDescription()+<span class="string">&quot;,加奶盖&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//利用委托的方式得到饮料价钱，然后再追加调料的价钱</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> beverage.cost() + <span class="number">1.5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>Ice冰块类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调料类继承于CondimentDecorator，而它又继承于Beverage</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ice</span> <span class="keyword">extends</span> <span class="title class_">CondimentDecorator</span>&#123;</span><br><span class="line">    <span class="comment">/*引用一个Beverage，它就是被装饰者(饮料)，需要将被装饰者记录在装饰者中*/</span></span><br><span class="line">    Beverage beverage;</span><br><span class="line">    <span class="comment">//被装饰者(饮料)通过构造函数传参，给到beverage，将饮料记录到实例变量中</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Ice</span><span class="params">(Beverage beverage)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.beverage = beverage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//利用委托的方式得到一个饮料描述，然后再追加调料描述</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> beverage.getDescription()+<span class="string">&quot;,加冰&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//利用委托的方式得到饮料价钱，然后再追加调料的价钱</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> beverage.cost() + <span class="number">0.5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>测试</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Beverage</span> <span class="variable">beverage1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Coffee</span>();</span><br><span class="line">        beverage1 = <span class="keyword">new</span> <span class="title class_">Whip</span>(beverage1);<span class="comment">//用Whip装饰它</span></span><br><span class="line">        System.out.println(<span class="string">&quot;饮品1：&quot;</span>+beverage1.getDescription()+</span><br><span class="line">                <span class="string">&quot;，价格：&quot;</span>+beverage1.cost());</span><br><span class="line"></span><br><span class="line">        <span class="type">Beverage</span> <span class="variable">beverage2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MilkTea</span>();</span><br><span class="line">        beverage2 = <span class="keyword">new</span> <span class="title class_">Whip</span>(beverage2);<span class="comment">//用Whip装饰它</span></span><br><span class="line">        beverage2 = <span class="keyword">new</span> <span class="title class_">Ice</span>(beverage2);<span class="comment">//用Ice装饰它</span></span><br><span class="line">        System.out.println(<span class="string">&quot;饮品2：&quot;</span>+beverage2.getDescription()+</span><br><span class="line">                <span class="string">&quot;，价格：&quot;</span>+beverage2.cost());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>运行结果</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">饮品1：咖啡,加奶盖，价格：11.5</span><br><span class="line">饮品2：奶茶,加奶盖,加冰，价格：10.0</span><br></pre></td></tr></table></figure></div>

<h2 id="Java-I-x2F-O"><a href="#Java-I-x2F-O" class="headerlink" title="Java I&#x2F;O"></a>Java I&#x2F;O</h2><p>Java I&#x2F;O在设计类的时候采用到了装饰者模式，实际上，里面的许多类都是装饰者。</p>
<p><img src="https://image.itbaima.net/images/253/image-20230902164726755.png" alt="pic/java_IO例子.png"></p>
<p>看一下输入流的类图(输出流同理，Reader&#x2F;Writer流略有不同，但也很类似)</p>
<p><img src="https://image.itbaima.net/images/253/image-20230902166421594.png" alt="pic/输入流为例.png"></p>
<blockquote>
<p>Java I&#x2F;O引出装饰者模式的缺点：<br>① 设计中有大量的小类，过度使用会使程序变得复杂，他人在第一次接触时可能难以理解，在调用API的时候产生困惑<br>② 类型问题：可以透明地插入装饰者，客户程序甚至不需知道自己在和装饰者打交道。但如果某一代码会依赖特定的类型，这样的代码又插入装饰者，就会出问题。因此在插入装饰者时要小心谨慎。</p>
</blockquote>
<h1 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h1><h2 id="定义-3"><a href="#定义-3" class="headerlink" title="定义"></a>定义</h2><h2 id="引子-简单工厂"><a href="#引子-简单工厂" class="headerlink" title="引子-简单工厂"></a>引子-简单工厂</h2><h2 id="例子-3"><a href="#例子-3" class="headerlink" title="例子"></a>例子</h2><h1 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h1><h2 id="定义-4"><a href="#定义-4" class="headerlink" title="定义"></a>定义</h2><h2 id="例子-4"><a href="#例子-4" class="headerlink" title="例子"></a>例子</h2><h2 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h2><h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><h2 id="定义-5"><a href="#定义-5" class="headerlink" title="定义"></a>定义</h2><p>单例模式确保一个类只有一个实例，且提供一个全局访问点</p>
<p>关键点：<br>① private的构造函数：外界不能通过new来创建该类的实例对象<br>② 静态的类对象属性，保存全局唯一的类实例<br>③ 静态的getInstance()方法，确保能通过类调用该方法（不需要提前创建对象），这个方法就是那个全局访问点</p>
<p>按实例化的时机，分为急切实例化和延迟实例化<br>前者是线程安全的，后者线程不安全</p>
<p>单例模式最初模型（没有解决多线程问题）</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="comment">//静态的类对象，通过构造函数第一次创建它后，在类中保存这个唯一的实例对象</span></span><br><span class="line">    <span class="comment">//1、不立即创建，搭配延迟实例化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton uniqueInstance;</span><br><span class="line">    <span class="comment">/*2、急切实例化：声明的同时创建该对象，get方法直接不用判断，直接返回它即可。</span></span><br><span class="line"><span class="comment">    适合于该单例对象必然/会被频繁使用，或创建的负担不大的情况</span></span><br><span class="line"><span class="comment">    并且这样的做法是线程安全的</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//private static Singleton uniqueInstance = new Singleton();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数设置为private，外界就不能随意地用new来创建该类地实例对象了</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*静态类方法可以在实例对象创建出来之前，通过类来调用</span></span><br><span class="line"><span class="comment">    这样就可以向外界提供获得该类实例对象的接口*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*延迟实例化：在这个get方法中，检测到实例对象还没被创建，则调用构造函数</span></span><br><span class="line"><span class="comment">    并将它赋值给这个类的唯一实例对象。这样做的好处是，当外界需要这个实例对象时(调用该方法)</span></span><br><span class="line"><span class="comment">    才会进行对象创建，否则永远不会创建。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    多线程时会带来问题（而急切实例化则是线程安全的）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (uniqueInstance==<span class="literal">null</span>)uniqueInstance=<span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>测试</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//由于构造函数设置为private，外界不能用new来创建实例了</span></span><br><span class="line">        <span class="comment">//Singleton a =new Singleton();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//外界只能通过getInstance()这个为接口获得该类的实例对象</span></span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">a</span> <span class="operator">=</span> Singleton.getInstance();</span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">b</span> <span class="operator">=</span> Singleton.getInstance();</span><br><span class="line">        <span class="comment">//通过对象的地址，验证这两个实例对象是否是同一个</span></span><br><span class="line">        <span class="keyword">if</span>(a==b) System.out.println(<span class="string">&quot;这两个实例对象其实是同一个&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> System.out.println(<span class="string">&quot;这两个实例对象不一样&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>结果</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这两个实例对象其实是同一个</span><br></pre></td></tr></table></figure></div>

<h2 id="解决多线程问题的方案"><a href="#解决多线程问题的方案" class="headerlink" title="解决多线程问题的方案"></a>解决多线程问题的方案</h2><p>延迟实例化在多线程运行的环境下，可能会返回两个不同的类实例对象【多个线程同时进入getInstance()方法】，违反了“单例”，可能对运行结果带来极大的负面影响，造成混乱</p>
<p>如下同，居然返回两个不同的对象</p>
<table>
<thead>
<tr>
<th>线程1</th>
<th>线程2</th>
<th>uniqueInstance的值</th>
</tr>
</thead>
<tbody><tr>
<td>getInstance()</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td></td>
<td>getInstance()</td>
<td>null</td>
</tr>
<tr>
<td>if (uniqueInstance&#x3D;&#x3D;null)</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td></td>
<td>if (uniqueInstance&#x3D;&#x3D;null)</td>
<td>null</td>
</tr>
<tr>
<td>uniqueInstance&#x3D;new Singleton()</td>
<td></td>
<td>obj1</td>
</tr>
<tr>
<td>return uniqueInstance</td>
<td></td>
<td>obj1</td>
</tr>
<tr>
<td></td>
<td>uniqueInstance&#x3D;new Singleton()</td>
<td>obj2</td>
</tr>
<tr>
<td></td>
<td>return uniqueInstance</td>
<td>obj2</td>
</tr>
</tbody></table>
<h3 id="急切实例化"><a href="#急切实例化" class="headerlink" title="急切实例化"></a>急切实例化</h3><p>这是最简单直接的方法，在声明唯一实例对象的同时创建它，在getInstance()中就不用判断，创建对象了，直接返回这唯一的实例对象即可</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在静态初始化器中创建单例对象，在使用前就创好了，保证线程安全</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">uniqueInstance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br></pre></td></tr></table></figure></div>

<p>这种做法适合于该单例对象必然&#x2F;会被频繁使用，或创建的负担不大的情况</p>
<h3 id="getInstance-设置为同步方法"><a href="#getInstance-设置为同步方法" class="headerlink" title="getInstance()设置为同步方法"></a>getInstance()设置为同步方法</h3><p>为getInstance()方法添加<code>synchronized</code>关键字，迫使每个线程在进入该方法前，都需等待其他线程离开该方法。即不允许有两个线程同时进入该方法</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Singleton==<span class="literal">null</span>)uniqueInstance=<span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></div>

<p>事实上，只有第一次调用getInstance()才需要同步，一旦uniqueInstance被设置好，就不再需要同步了。</p>
<p>因此这种做法在之后的每次调用，都会做没必要的同步，对性能造成一定损耗</p>
<h3 id="双重检查加锁"><a href="#双重检查加锁" class="headerlink" title="双重检查加锁"></a>双重检查加锁</h3><p>针对同步方法的不足，可以进一步优化：<br>先检查实例是否被创建，如果没创建，才进行同步。这样一来，只有第一次会同步</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="comment">/*添加volatile关键字</span></span><br><span class="line"><span class="comment">    synchronized保证可见性和原子性，但new对象的过程不是原子性，所以需要 volatile保证有序性。</span></span><br><span class="line"><span class="comment">    这也就保证了uniqueInstance在线程之间的可见性，当其他线程进入之后，</span></span><br><span class="line"><span class="comment">    才会拿到uniqueInstance由其他线程更新的最新值去判断*/</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton uniqueInstance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//检查实例，如果不存在，就进入同步块（只有第一次才彻底执行里面的代码）</span></span><br><span class="line">        <span class="keyword">if</span>(uniqueInstance==<span class="literal">null</span>)&#123;</span><br><span class="line">          <span class="keyword">synchronized</span>(Singleton.class)&#123;</span><br><span class="line">            <span class="comment">//进入后再检查一次，仍是null才创建实例</span></span><br><span class="line">            <span class="keyword">if</span> (uniqueInstance==<span class="literal">null</span>)uniqueInstance=<span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>如果对性能有一定要求，可以使用这个方法，但要确保是Java5以上的版本</p>
<h3 id="静态内部类"><a href="#静态内部类" class="headerlink" title="静态内部类"></a>静态内部类</h3><p>使用静态内部类，可以在不加锁的同时，解决多线程问题<br>但是这种做法跟语言本身有一定的关联，并不是所有的语言都支持这种写法。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="comment">/*由私有静态内部类持有单例对象，但是根据类加载特性，</span></span><br><span class="line"><span class="comment">    仅使用Singleton类时，不会对静态内部类进行初始化</span></span><br><span class="line"><span class="comment">    只有当使用到这个静态内部类时才会进行类初始化*/</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Holder</span> &#123;   </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">uniqueInstance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span>&#123;   </span><br><span class="line">        <span class="keyword">return</span> Holder.uniqueInstance;   <span class="comment">//直接获取内部类中的</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h1><h2 id="定义-6"><a href="#定义-6" class="headerlink" title="定义"></a>定义</h2><p>命令模式将请求和请求的接收方分离，将请求封装为特定的命令对象，其中包含它的接收方以及执行请求的execute()方法(调用接收方的行为)。还需要一个调用者，通过setCommand()来设置命令(请求)，通过某方法触发命令的执行。<br>通过这样的设计，就可以把“动作的请求者”(调用者)从“动作的执行者”(接收方)中解耦出来</p>
<p>从以上描述，可以得知命令模式由三部分组成<br>(1) 请求对象<br>(2) 请求接收方<br>(3) 调用方</p>
<p>设计思路以及类图如下：</p>
<p><img src="https://image.itbaima.net/images/253/image-20230902167419556.png" alt="pic/命令模式设计图.png"><br><img src="https://image.itbaima.net/images/253/image-2023090216956862.png" alt="pic/命令模式类图.png"></p>
<h2 id="例子-5"><a href="#例子-5" class="headerlink" title="例子"></a>例子</h2><p>取自《Head First 设计模式》</p>
<blockquote>
<p>为厂家的遥控器编写好功能：<br>遥控器有三个槽slot，分别代表电视，音箱和卧室灯，给遥控器插入对应槽即可控制对应家电。每个槽都有一对on，off按钮，整个遥控器还有一个undo按钮，用来撤销上一步</p>
</blockquote>
<p>厂家提供的各个家电的API如下：</p>
<table>
<thead>
<tr>
<th>TV</th>
</tr>
</thead>
<tbody><tr>
<td>on()</br>off()</br>setChannel()</br>setVolume()</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>BrLight</th>
</tr>
</thead>
<tbody><tr>
<td>on()</br>off()</br>dim()</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>Stereo</th>
</tr>
</thead>
<tbody><tr>
<td>on()</br>off()</br>setCD()</br>setVolume()</br>setRadio()</td>
</tr>
</tbody></table>
<p><strong>分析过程</strong></p>
<p>最简单直接的想法<br>给on&#x2F;off按钮写一个函数，用if-else语句判断每个槽的类型，调用对应的方法。<br>这样的设计很糟糕：如果未来有更多厂商加入，只要有新的家电进来，就要修改代码。这是因为遥控器知道厂家具体的调用细节，“动作的请求者”(遥控器)和“动作的执行者”(家电)强耦合在一起</p>
<hr>
<p>采用命令模式</p>
<blockquote>
<p>涉及到：<br>NoCommand空对象<br>undo操作：如果想undo多步，可以用一个堆栈结构存储执行过的命令<br>宏命令</p>
</blockquote>
<p>RemoteControl类：调用者</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//遥控器类，也就是调用者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoteControl</span> &#123;</span><br><span class="line">    <span class="comment">//开/关命令集合</span></span><br><span class="line">    Command[] onCommands;</span><br><span class="line">    Command[] offCommands;</span><br><span class="line">    <span class="comment">//保存上一步命令，用来undo</span></span><br><span class="line">    Command lastCommand;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建控制器时，将三个命令槽创建出来，并初始化为空命令</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RemoteControl</span><span class="params">()</span>&#123;</span><br><span class="line">        onCommands = <span class="keyword">new</span> <span class="title class_">Command</span>[<span class="number">3</span>];</span><br><span class="line">        offCommands = <span class="keyword">new</span> <span class="title class_">Command</span>[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">        <span class="type">Command</span> <span class="variable">noCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NoCommand</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++)&#123;</span><br><span class="line">            onCommands[i] = noCommand;</span><br><span class="line">            offCommands[i] = noCommand;</span><br><span class="line">        &#125;</span><br><span class="line">        lastCommand = noCommand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//三个参数：插入槽的位置，开命令，关命令</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCommand</span><span class="params">(<span class="type">int</span> slot,Command onCommand, Command offCommand)</span>&#123;</span><br><span class="line">        onCommands[slot] = onCommand;</span><br><span class="line">        offCommands[slot] = offCommand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//按下on按钮就调用该方法，需要传入是按哪个槽的on按钮</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onButtonWasPushed</span><span class="params">(<span class="type">int</span> slot)</span>&#123;</span><br><span class="line">        <span class="comment">//执行对应槽的命令</span></span><br><span class="line">        onCommands[slot].execute();</span><br><span class="line">        <span class="comment">//将刚刚执行的命令保存为“上一条命令”，用于undo</span></span><br><span class="line">        lastCommand = onCommands[slot];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//按下off按钮就调用该方法，需要传入是按哪个槽的off按钮</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">offButtonWasPushed</span><span class="params">(<span class="type">int</span> slot)</span>&#123;</span><br><span class="line">        <span class="comment">//执行对应槽的命令</span></span><br><span class="line">        offCommands[slot].execute();</span><br><span class="line">        <span class="comment">//将刚刚执行的命令保存为“上一条命令”，用于undo</span></span><br><span class="line">        lastCommand = offCommands[slot];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undoButtonWasPushed</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//执行上一条命令</span></span><br><span class="line">        lastCommand.undo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuffer</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        stringBuffer.append(<span class="string">&quot;\n******控制器当前状态*******\n&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">            stringBuffer.append(<span class="string">&quot;第&quot;</span>).append(i + <span class="number">1</span>).append(<span class="string">&quot;号槽：&quot;</span>)</span><br><span class="line">                    .append(onCommands[i].getClass().getName()).append(<span class="string">&quot; ,&quot;</span>)</span><br><span class="line">                    .append(offCommands[i].getClass().getName()).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuffer.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>Tv类：电视实体类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tv</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">on</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电视开机&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">off</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电视关机&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChannel</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;跳转到电视默认频道：cctv1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(<span class="type">int</span> volume)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电视音量设置为：&quot;</span>+volume);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>BrLight类：卧室灯实体类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BrLight</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">on</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;卧室灯开启&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">off</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;卧室灯关闭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dim</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;卧室灯进入暗淡模式&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>Stereo类：音箱类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Stereo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">on</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;音箱开启&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">off</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;音箱关闭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCD</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;放入并读取CD&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(<span class="type">int</span> volume)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;音量设置为：&quot;</span>+volume);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>Command接口：所有命令对象都要实现该接口</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//所有命令对象都需要execute()方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>BrLightOffCommand类：关闭卧室灯命令</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BrLightOffCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span>&#123;</span><br><span class="line">    BrLight brLight;<span class="comment">//命令对象需要封装一个接收者，即动作执行者</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建时传入命令的接收对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BrLightOffCommand</span><span class="params">(BrLight brLight)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.brLight = brLight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//execute()执行命令，实际上是委托接收者进行动作执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        brLight.off();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//撤销卧室灯的off命令，其实就是调用卧室灯的on命令</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        brLight.on();</span><br><span class="line">        brLight.dim();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>BrLightOnCommand类：打开卧室灯命令</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BrLightOnCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    BrLight brLight;<span class="comment">//命令对象需要封装一个接收者，即动作执行者</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建时传入命令的接收对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BrLightOnCommand</span><span class="params">(BrLight brLight)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.brLight = brLight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//execute()执行命令，实际上是委托接收者进行动作执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        brLight.on();</span><br><span class="line">        brLight.dim();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//撤销卧室灯的on按钮，其实就是调用卧室灯的off按钮</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        brLight.off();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>TvOnCommand类：打开Tv命令</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TvOnCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span>&#123;</span><br><span class="line">    Tv tv;<span class="comment">//命令对象需要封装一个接收者，即动作执行者</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建时传入命令的接收对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TvOnCommand</span><span class="params">( Tv tv)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.tv = tv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//execute()执行命令，实际上是委托接收者进行动作执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        tv.on();</span><br><span class="line">        tv.setChannel();</span><br><span class="line">        tv.setVolume(<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//撤销”开电视“命令，其实就是”关电视“</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        tv.off();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>TvOffCommand类：关闭电视命令</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TvOffCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span>&#123;</span><br><span class="line">    Tv tv;<span class="comment">//命令对象需要封装一个接收者，即动作执行者</span></span><br><span class="line">    <span class="comment">//execute()执行命令，实际上是委托接收者进行动作执行</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建时传入命令的接收对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TvOffCommand</span><span class="params">( Tv tv)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.tv = tv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        tv.off();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//撤销”关电视“命令，其实就是”开电视“</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        tv.on();</span><br><span class="line">        tv.setChannel();</span><br><span class="line">        tv.setVolume(<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>StereoOnCommand类：打开音箱命令</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StereoOnCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span>&#123;</span><br><span class="line">    Stereo stereo;<span class="comment">//命令对象需要封装一个接收者，即动作执行者</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建时传入命令的接收对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StereoOnCommand</span><span class="params">(Stereo stereo)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.stereo = stereo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//execute()执行命令，实际上是委托接收者进行动作执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        stereo.on();</span><br><span class="line">        stereo.setCD();</span><br><span class="line">        stereo.setVolume(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//撤销”开启音箱“命令，其实就是”关音箱“</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        stereo.off();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>StereoOffCommand类：关闭音箱命令</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StereoOffCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    Stereo stereo;<span class="comment">//命令对象需要封装一个接收者，即动作执行者</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建时传入命令的接收对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StereoOffCommand</span><span class="params">(Stereo stereo)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.stereo = stereo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//execute()执行命令，实际上是委托接收者进行动作执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        stereo.off();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//撤销”关音箱“命令，其实就是”开启音箱“</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        stereo.on();</span><br><span class="line">        stereo.setCD();</span><br><span class="line">        stereo.setVolume(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>NoCommand类：空命令</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">可以将返回null的责任转给空对象，这种对象什么都不做</span></span><br><span class="line"><span class="comment">在许多设计模式中，空对象是很常见的</span></span><br><span class="line"><span class="comment">1、一个产品设计出来后，不可能马上有功能，此时可以先用空对象</span></span><br><span class="line"><span class="comment">2、避免if来判断null</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NoCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NoCommand</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//空命令什么都不做</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>测试</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">RemoteControl</span> <span class="variable">remoteControl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteControl</span>();</span><br><span class="line">        <span class="comment">//将第一个槽和卧室灯绑定</span></span><br><span class="line">        <span class="type">BrLight</span> <span class="variable">brLight</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrLight</span>();</span><br><span class="line">        <span class="type">BrLightOnCommand</span> <span class="variable">brLightOnCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrLightOnCommand</span>(brLight);</span><br><span class="line">        <span class="type">BrLightOffCommand</span> <span class="variable">brLightOffCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrLightOffCommand</span>(brLight);</span><br><span class="line">        remoteControl.setCommand(<span class="number">0</span>, brLightOnCommand, brLightOffCommand);</span><br><span class="line">        <span class="comment">//测试：第一个槽的按钮on/off操作</span></span><br><span class="line">        remoteControl.onButtonWasPushed(<span class="number">0</span>);</span><br><span class="line">        remoteControl.offButtonWasPushed(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//测试：撤销卧室灯关闭的命令</span></span><br><span class="line">        System.out.println(<span class="string">&quot;********\n&quot;</span>+<span class="string">&quot;撤销卧室灯关闭的命令后：&quot;</span>);</span><br><span class="line">        remoteControl.undoButtonWasPushed();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//测试：尚未设置命令的槽，应该什么都不做</span></span><br><span class="line">        remoteControl.onButtonWasPushed(<span class="number">1</span>);</span><br><span class="line">        remoteControl.offButtonWasPushed(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//测试：查看遥控器当前各个槽的状态（用到了重写的toString方法）</span></span><br><span class="line">        System.out.println(remoteControl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>测试结果</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">卧室灯开启</span><br><span class="line">卧室灯进入暗淡模式</span><br><span class="line">卧室灯关闭</span><br><span class="line">********</span><br><span class="line">撤销卧室灯关闭的命令后：</span><br><span class="line">卧室灯开启</span><br><span class="line">卧室灯进入暗淡模式</span><br><span class="line"></span><br><span class="line">******控制器当前状态*******</span><br><span class="line">第1号槽：Command.BrLightOnCommand ,Command.BrLightOffCommand</span><br><span class="line">第2号槽：Command.NoCommand ,Command.NoCommand</span><br><span class="line">第3号槽：Command.NoCommand ,Command.NoCommand</span><br></pre></td></tr></table></figure></div>

<hr>
<p>宏命令：该命令将一次性执行多个命令，并且可以动态指定命令的组成</p>
<p>MarcoCommand类：宏命令类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Command;</span><br><span class="line"><span class="comment">//宏命令：用一个命令来执行一组命令</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MarcoCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span>&#123;</span><br><span class="line">    <span class="comment">//一组命令的集合</span></span><br><span class="line">    Command[] commands;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MarcoCommand</span><span class="params">(Command[] commands)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.commands = commands;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i &lt; commands.length; i++)&#123;</span><br><span class="line">            commands[i].execute();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=commands.length - <span class="number">1</span>;i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line">            commands[i].undo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>测试</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">RemoteControl</span> <span class="variable">remoteControl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteControl</span>();</span><br><span class="line">        <span class="comment">//创建卧室灯的开，关命令</span></span><br><span class="line">        <span class="type">BrLight</span> <span class="variable">brLight</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrLight</span>();</span><br><span class="line">        <span class="type">BrLightOnCommand</span> <span class="variable">brLightOnCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrLightOnCommand</span>(brLight);</span><br><span class="line">        <span class="type">BrLightOffCommand</span> <span class="variable">brLightOffCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrLightOffCommand</span>(brLight);</span><br><span class="line">        <span class="comment">//创建电视的开，关命令</span></span><br><span class="line">        <span class="type">Tv</span> <span class="variable">tv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tv</span>();</span><br><span class="line">        <span class="type">TvOnCommand</span> <span class="variable">tvOnCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TvOnCommand</span>(tv);</span><br><span class="line">        <span class="type">TvOffCommand</span> <span class="variable">tvOffCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TvOffCommand</span>(tv);</span><br><span class="line">        <span class="comment">//创建音箱的开，关命令</span></span><br><span class="line">        <span class="type">Stereo</span> <span class="variable">stereo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Stereo</span>();</span><br><span class="line">        <span class="type">StereoOnCommand</span> <span class="variable">stereoOnCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StereoOnCommand</span>(stereo);</span><br><span class="line">        <span class="type">StereoOffCommand</span> <span class="variable">stereoOffCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StereoOffCommand</span>(stereo);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//一个数组记录所有on命令，一个数组记录所有off命令</span></span><br><span class="line">        Command[] onCommands = &#123;brLightOnCommand, tvOnCommand, stereoOnCommand&#125;;</span><br><span class="line">        Command[] offCommands = &#123;brLightOffCommand, tvOffCommand, stereoOffCommand&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个on宏命令和一个off宏命令</span></span><br><span class="line">        <span class="type">MarcoCommand</span> <span class="variable">onMarco</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MarcoCommand</span>(onCommands);</span><br><span class="line">        <span class="type">MarcoCommand</span> <span class="variable">offMarco</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MarcoCommand</span>(offCommands);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将宏命令指定给控制器的第一个槽</span></span><br><span class="line">        remoteControl.setCommand(<span class="number">0</span>, onMarco, offMarco);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//测试：查看当前控制器的状态</span></span><br><span class="line">        System.out.println(remoteControl);</span><br><span class="line">        <span class="comment">//测试：按下第一个槽的on和第一个槽的off</span></span><br><span class="line">        System.out.println(<span class="string">&quot;********按下on按钮**********&quot;</span>);</span><br><span class="line">        remoteControl.onButtonWasPushed(<span class="number">0</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;********按下off按钮**********&quot;</span>);</span><br><span class="line">        remoteControl.offButtonWasPushed(<span class="number">0</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;********按下undo按钮**********&quot;</span>);</span><br><span class="line">        <span class="comment">//测试：undo操作</span></span><br><span class="line">        remoteControl.undoButtonWasPushed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>结果</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">******控制器当前状态*******</span><br><span class="line">第1号槽：Command.MarcoCommand ,Command.MarcoCommand</span><br><span class="line">第2号槽：Command.NoCommand ,Command.NoCommand</span><br><span class="line">第3号槽：Command.NoCommand ,Command.NoCommand</span><br><span class="line">********按下on按钮**********</span><br><span class="line">卧室灯开启</span><br><span class="line">卧室灯进入暗淡模式</span><br><span class="line">电视开机</span><br><span class="line">跳转到电视默认频道：cctv1</span><br><span class="line">电视音量设置为：5</span><br><span class="line">音箱开启</span><br><span class="line">放入并读取CD</span><br><span class="line">音量设置为：10</span><br><span class="line">********按下off按钮**********</span><br><span class="line">卧室灯关闭</span><br><span class="line">电视关机</span><br><span class="line">音箱关闭</span><br><span class="line">********按下undo按钮**********</span><br><span class="line">音箱开启</span><br><span class="line">放入并读取CD</span><br><span class="line">音量设置为：10</span><br><span class="line">电视开机</span><br><span class="line">跳转到电视默认频道：cctv1</span><br><span class="line">电视音量设置为：5</span><br><span class="line">卧室灯开启</span><br><span class="line">卧室灯进入暗淡模式</span><br></pre></td></tr></table></figure></div>

<h2 id="队列请求"><a href="#队列请求" class="headerlink" title="队列请求"></a>队列请求</h2><h2 id="日志请求"><a href="#日志请求" class="headerlink" title="日志请求"></a>日志请求</h2><h1 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h1><h2 id="定义-7"><a href="#定义-7" class="headerlink" title="定义"></a>定义</h2><p>适配器相当于一个转换器，中间人，将一个类的接口转换成客户期望的另一个接口，从而使得接口不兼容的类可以相互合作</p>
<p><img src="https://image.itbaima.net/images/253/image-20230902163740455.png" alt="pic/适配器形象展示.png"></p>
<p>适配器模式有三个组成部分：目标接口(客户)，适配器，被适配者<br>运行机制：</p>
<ol>
<li>客户通过目标接口调用适配器方法，向适配器发送请求</li>
<li>适配器把请求转换成调用一&#x2F;多个被适配者接口</li>
<li>客户得到响应，察觉不到适配器在其中起到转换作用，且客户与被适配者是解耦的，相互不认识</li>
</ol>
<p>实际上，适配器有两种：对象适配器，类适配器</p>
<p>对象适配器的类图如下<br>特点：<br>(1) 使用对象组合：适配器中组合许多被适配者<br>(2) 适配器实现目标接口<br>(3) 被适配者的任何子类都可以搭配适配器【组合的优势】<br><img src="https://image.itbaima.net/images/253/image-20230902165043483.png" alt="pic/对象适配器的类图.png"></p>
<p>类适配器的类图如下</p>
<blockquote>
<p>注：只有允许多继承的语言才可以实现类适配器。比如Java就不行</p>
</blockquote>
<p>特点：<br>(1) 使用多重继承：适配器继承于目标接口和被适配者<br>(2) 不需要重新实现整个被适配者，只在必要时候覆盖行为即可【继承的优势】<br>(3) 对象~ 的设计更弹性，类~ 的设计更有效率(使用时，只需要一个类适配器，而不用适配器+被适配者)<br><img src="https://image.itbaima.net/images/253/image-20230902168896168.png" alt="pic/类适配器的类图.png"></p>
<p>注意：<br>(1) 大多数情况下，一个适配器只包装一个被适配者，但实际上，可以包装多个。<br>(2) 双向适配器可以做到两边兼容</p>
<h2 id="例子-6"><a href="#例子-6" class="headerlink" title="例子"></a>例子</h2><p>取自《Head First 设计模式》</p>
<blockquote>
<p>早期Java集合类型都要实现elements()方法，返回一个Enumeration，这个接口可以遍历集合中的每个元素。</p>
<p>最新的集合类型开始使用Iterator接口，该接口与Enumeration相似，但还提供了删除元素的的能力</p>
<p>像这样类似的改版，会产生一些历史遗留代码：这些代码暴露出枚举类接口，但现在又希望所有新代码都只使用迭代器。<br>此时，就可以构造一个适配器，将枚举适配到迭代器</p>
</blockquote>
<p><img src="https://image.itbaima.net/images/253/image-20230902166740483.png" alt="pic/将枚举适配到迭代器.png"></p>
<hr>
<p>Iteration接口是目标接口，Enumeration接口是被适配者，构造一个EIAdapter实现适配</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//要适配成迭代器，需要实现迭代器，使得这个适配器看起来像迭代器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EIAdapter</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">    <span class="comment">//利用组合的方式将枚举结合进入适配器，在适配器创建的时候指定它</span></span><br><span class="line">    Enumeration enumeration;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EIAdapter</span><span class="params">(Enumeration enumeration)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.enumeration = enumeration;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//迭代器的hasNext()方法委托给枚举的hasMoreElements()方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> enumeration.hasMoreElements();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//迭代器的next()方法委托给枚举的nextElement()方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> enumeration.nextElement();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//枚举不支持删除，因此抛出异常即可</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>这样，就可以通过这个适配器去处理那些依然会产生枚举的遗留类</p>
<h1 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h1><h2 id="定义-8"><a href="#定义-8" class="headerlink" title="定义"></a>定义</h2><p>外观模式提供了一个统一的接口，用来访问子系统中的一组接口，使得子系统更易使用。主要有两个特点：<br>(1) 简化并统一接口(目的)<br>(2) 将客户从子系统中解耦<br>(3) 体现OO原则—“最少知识”原则</p>
<p>类图如下：<br><img src="https://image.itbaima.net/images/253/image-20230902167247178.png" alt="pic/外观模式类图.png"></p>
<p>注意：<br>(1) 外观模式没有封装子系统的类，只是提供了一个简化的，统一的接口。如果需要，客户仍然可以单独使用子系统的类。<br>(2) 外观模式可以附加新功能，使得子系统的使用更加方便<br>(3) 可以为一个子系统创建多个外观<br>(4) 子系统中类的数量是没有关系的。比如外观模式可以只针对一个拥有复杂接口的类提供简化的接口。</p>
<h2 id="例子-7"><a href="#例子-7" class="headerlink" title="例子"></a>例子</h2><h1 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h1><h2 id="定义-9"><a href="#定义-9" class="headerlink" title="定义"></a>定义</h2><p>模板方法定义了算法的骨架(一组步骤)，将一些步骤延迟到子类中去实现，使得子类在不改变算法结构的情况下，能重新定义算法的某些步骤。是提高代码复用性的一个技巧。<br>该模板方法存放在一个抽象类中，主要有四个组成部分：<br>(1) 模板方法：包含算法执行的步骤，即一组方法的调用。通常用<code>final</code>修饰，防止子类修改模板方法<br>(2) 具体方法：算法中能公共使用的方法(复用)，在抽象类中给它们具体的实现。通常用<code>final</code>修饰，防止子类修改它<br>(3) 抽象方法：算法中个性的方法定义为抽象方法，交给子类去实现<br>(4) 钩子：算法中可选的方法，一般什么都不做，或给一个默认行为。子类可以选择覆盖也可以不覆盖它。</p>
<p>类图如下：<br><img src="https://image.itbaima.net/images/253/image-20230902163661648.png" alt="pic/模板方法模式类图1.png"><br><img src="https://image.itbaima.net/images/253/image-20230902164894790.png" alt="pic/模板方法模式类图2.png"></p>
<p>注意：<br>(1) 子类必须实现的步骤，定义为抽象方法；若步骤是可选的，子类并不被强制要求实现它时，定义为为钩子<br>(2) 模板方法体现OO原则—“好莱坞原则”<br>(3) 模板方法模式非常常见，特别是在创建框架的时候：由框架决定如何做事，使用框架的人指定框架算法中每个步骤的细节<br>(4) 对于特定环境和约束，一些采用该模式的地方，在表现上和上面的定义会有些出入<br>(5) 策略模式和模板方法模式都封装算法，一个用组合，一个用继承<br>(6) 工厂方法是模板方法的一种特殊版本</p>
<h2 id="例子-8"><a href="#例子-8" class="headerlink" title="例子"></a>例子</h2>
            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li>Post title：常用的设计模式</li>
        <li>Post author：萧</li>
        <li>Create time：2023-07-29 08:13:24</li>
        <li>
            Post link：https://redefine.ohevan.com/2023/07/29/设计模式/设计模式/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

                </div>
            

            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                            rel="prev"
                            href="/2023/08/01/Java%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C/JWT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
                            >
                                <span class="left arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </span>
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">JWT学习笔记</span>
                                    <span class="post-nav-item">Prev posts</span>
                                </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/2023/07/15/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/OO%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">OO设计原则</span>
                                    <span class="post-nav-item">Next posts</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            

            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div style="font-size: 1.3rem;margin-top: 0; margin-bottom: 0.8rem; transition-duration: 0.1s;"><i class="fa-solid fa-list"></i> <strong>Contents</strong></div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#OO%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="nav-text">OO设计原则</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="nav-text">策略模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-text">定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90"><span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="nav-text">观察者模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-1"><span class="nav-text">定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90-1"><span class="nav-text">例子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java%E5%86%85%E7%BD%AEAPI"><span class="nav-text">Java内置API</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="nav-text">装饰者模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-2"><span class="nav-text">定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90-2"><span class="nav-text">例子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-I-x2F-O"><span class="nav-text">Java I&#x2F;O</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="nav-text">工厂方法模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-3"><span class="nav-text">定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%95%E5%AD%90-%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82"><span class="nav-text">引子-简单工厂</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90-3"><span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="nav-text">抽象工厂模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-4"><span class="nav-text">定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90-4"><span class="nav-text">例子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AF%94%E8%BE%83"><span class="nav-text">比较</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="nav-text">单例模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-5"><span class="nav-text">定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%97%AE%E9%A2%98%E7%9A%84%E6%96%B9%E6%A1%88"><span class="nav-text">解决多线程问题的方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A5%E5%88%87%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="nav-text">急切实例化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#getInstance-%E8%AE%BE%E7%BD%AE%E4%B8%BA%E5%90%8C%E6%AD%A5%E6%96%B9%E6%B3%95"><span class="nav-text">getInstance()设置为同步方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E5%8A%A0%E9%94%81"><span class="nav-text">双重检查加锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB"><span class="nav-text">静态内部类</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="nav-text">命令模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-6"><span class="nav-text">定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90-5"><span class="nav-text">例子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%98%9F%E5%88%97%E8%AF%B7%E6%B1%82"><span class="nav-text">队列请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E8%AF%B7%E6%B1%82"><span class="nav-text">日志请求</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="nav-text">适配器模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-7"><span class="nav-text">定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90-6"><span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="nav-text">外观模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-8"><span class="nav-text">定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90-7"><span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="nav-text">模板方法模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-9"><span class="nav-text">定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90-8"><span class="nav-text">例子</span></a></li></ol></li></ol>
    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>



        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2022</span>
              -
            
            2023&nbsp;<i class="fa-solid fa-heart icon-animate"></i>&nbsp;<a href="/">萧. All Rights Reserved.</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalviews&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v0.5.2</a>
        </div>
        
        
        <script async data-pjax defer>
            function odometer_init(){
                    let el = document.getElementsByClassName('odometer');
                    for (i = 0; i < el.length; i++) {
                        od = new Odometer({
                            el: el[i],
                            format: '( ddd).dd',
                            duration: 200
                        });
                    }
            }
            odometer_init();
        </script>
        <div id="start_time_div" style="display:none">
            2022/8/17 11:45:14
        </div>
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        

        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fa-solid fa-magnifying-glass-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fa-solid fa-magnifying-glass-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fa-solid fa-left-right"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fa-solid fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fa-solid fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fa-solid fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fa-solid fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>





    
<script src="/js/code-copy.js"></script>




    
<script src="/js/lazyload.js"></script>




    
<script src="/js/runtime.js"></script>

    
<script src="/js/odometer.min.js"></script>

    
<link rel="stylesheet" href="/css/odometer-theme-minimal.css">



<div class="post-scripts pjax">
    
        
<script src="/js/toc-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            REDEFINE.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            REDEFINE.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            REDEFINE.refresh();
        });
    });
</script>



</body>
</html>
