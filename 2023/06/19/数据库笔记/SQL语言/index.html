<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    <meta name="description" content="Hexo Theme Redefine">
    <meta name="author" content="萧">
    <link rel="canonical" href="http://example.com/2023/06/19/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/SQL%E8%AF%AD%E8%A8%80/" />
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-redefine.png">
    <link rel="icon" type="image/png" href="/images/redefine-logo.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/redefine-logo.svg">
    <link rel="shortcut icon" href="/images/redefine-logo.svg">
    
    <title>
        
            SQL语言 |
        
        等想好起什么名字后再来改
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/css/fonts.css">

    
    <link rel="preconnect" href="https://evan.beee.top" crossorigin>
    <script id="hexo-configurations">
    let REDEFINE = window.REDEFINE || {};
    REDEFINE.hexo_config = {"hostname":"example.com","root":"/","language":"en"};
    REDEFINE.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#005080","avatar":"/images/redefine-avatar.svg","favicon":"/images/redefine-logo.svg","article_img_align":"center","right_side_width":"210px","content_max_width":"1000px","nav_color":{"left":"#f78736","right":"#367df7","transparency":35},"hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"background_image":{"light":"https://evan.beee.top/img/wallhaven-wqery6-light.webp","dark":"https://evan.beee.top/img/wallhaven-wqery6-dark.webp"},"title_color":{"light":"#fff","dark":"#d1d1b6"},"description":"Theme Redefine"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":false,"preload":true},"code_block":{"copy":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"0.5.2","friend_links":{"columns":2}};
    REDEFINE.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
    
    
<link rel="stylesheet" href="/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/css/brands.min.css">

    
<link rel="stylesheet" href="/css/solid.min.css">

    
<link rel="stylesheet" href="/css/regular.min.css">

    
    
    
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">
    
    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                等想好起什么名字后再来改
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="pc">
                <ul class="menu-list">
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        主页
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        存档记录
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories"  >
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        分类
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-link"></i>
                                        
                                        快捷链接&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/link2">LINK2
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a href="/link3">LINK3
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                主页
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="" 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                存档记录
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="" 
                        href="/categories"  >
                             
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                分类
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-link"></i>
                                
                                快捷链接&nbsp;<i class="fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="/link2">LINK2</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="/link3">LINK3</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">
            <div class="article-title">
                <span class="title-hover-animation"><h1 style="font-size:2rem; font-weight: bold; margin: 10px 0;">SQL语言</h1></span>
            </div>

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/redefine-avatar.svg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">萧</span>
                            
                                <span class="author-label">lol</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="pc">2023-06-19 22:00:50</span>
        <span class="mobile">2023-06-19 22:00</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA/">数据库理论</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <h1 id="SQL语言分类"><a href="#SQL语言分类" class="headerlink" title="SQL语言分类"></a>SQL语言分类</h1><table>
<thead>
<tr>
<th>分类</th>
<th>功能</th>
<th>操作语句</th>
</tr>
</thead>
<tbody><tr>
<td>数据定义语言DDL</td>
<td>提供定义&#x2F;修改&#x2F;删除域&#x2F;关系&#x2F;视图&#x2F;索引&#x2F;数据库的命令</td>
<td>CREATE，ALTER，DROP</td>
</tr>
<tr>
<td>数据操纵语言DML</td>
<td>提供对数据库增删改查的能力</td>
<td>SELCT，INSERT，UPDATE，DELETE</td>
</tr>
<tr>
<td>数据控制语言DCL</td>
<td>提供管理权限的能力</td>
<td>GRANT，REVOKE，…</td>
</tr>
</tbody></table>
<h1 id="DDL数据定义语言"><a href="#DDL数据定义语言" class="headerlink" title="DDL数据定义语言"></a>DDL数据定义语言</h1><p><strong>SQL提供几种对象的定义</strong></p>
<ul>
<li>域(数据类型)【内置的有char(n)，varchar(n)，int，float，date，time，…】</li>
<li>关系</li>
<li>视图</li>
<li>索引</li>
<li>数据库</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>创建</th>
<th>修改</th>
<th>删除</th>
</tr>
</thead>
<tbody><tr>
<td>域</td>
<td>Create Domain</td>
<td></td>
<td>Drop Domain</td>
</tr>
<tr>
<td>关系</td>
<td>Create Table</td>
<td>Alter Table</td>
<td>Drop Table</td>
</tr>
<tr>
<td>视图</td>
<td>Create View</td>
<td></td>
<td>Drop View</td>
</tr>
<tr>
<td>索引</td>
<td>Create Index</td>
<td></td>
<td>Drop Index</td>
</tr>
<tr>
<td>数据库</td>
<td>Create Database</td>
<td></td>
<td>Drop Database</td>
</tr>
</tbody></table>
<p><strong>举例：定义关系</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span>  <span class="keyword">table</span>   SC (   　</span><br><span class="line">    SNO  <span class="type">VARCHAR</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span>, </span><br><span class="line">　　CNO  <span class="type">VARCHAR</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">　　<span class="keyword">RESULT</span>　<span class="type">INT</span>,</span><br><span class="line">　　<span class="keyword">primary</span>  key  (SNO, CNO),</span><br><span class="line">　　<span class="keyword">foreign</span>  key  (SNO)  <span class="keyword">references</span>  S (SNO),</span><br><span class="line">　　<span class="keyword">foreign</span>  key  (CNO)  <span class="keyword">references</span>  C (CNO),</span><br><span class="line">　　<span class="keyword">check</span>  ( (<span class="keyword">RESULT</span>  <span class="keyword">IS</span>  <span class="keyword">NULL</span>) <span class="keyword">OR</span> (<span class="keyword">RESULT</span>  <span class="keyword">BETWEEN</span>  <span class="number">0</span>  <span class="keyword">AND</span>  <span class="number">100</span>) )</span><br><span class="line">　)</span><br></pre></td></tr></table></figure></div>

<p><strong>举例：修改关系</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> S (<span class="keyword">add</span> DEPT <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>)</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> SC (modify <span class="keyword">RESULT</span> <span class="type">SMALLINT</span>)</span><br></pre></td></tr></table></figure></div>

<h1 id="DML数据操作语言"><a href="#DML数据操作语言" class="headerlink" title="DML数据操作语言"></a>DML数据操作语言</h1><h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><h3 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h3><p>查询操作最核心的就是select，from，where</p>
<p><strong>对应于关系代数</strong><br>select相当于投影运算（严谨的说，应该是select distinct等价于投影），from相当于笛卡尔积运算，where相当于选择运算</p>
<ul>
<li><strong>语义次序</strong>：From (笛卡儿积) → Where (选择) → Select (投影)</li>
<li>可以通过关系代数，按照对应关系转换成sql语句</li>
</ul>
<hr>
<p><strong>select子句</strong></p>
<ul>
<li><strong>select默认保留重复元组，即select all</strong>。如果想要对结果去重，需要在select后加<code>distinct</code>关键字。如 <code>select distinct A,B,C</code>，表示最终结果是对ABC组合进行去重操作后的结果。</li>
<li>属性列表中，可以<strong>用表达式来构造的新属性</strong>，相当于广义投影。比如 <code>select 2020-出生日期</code></li>
<li><strong>用<code>as</code>重命名</strong>。比如<code>select 姓名 as 学生姓名, 2023-出生日期 as 年龄</code></li>
<li><strong>同名属性必须加关系名前缀</strong>。比如<code>select R.姓名, S.姓名, S.性别 From R, S</code></li>
</ul>
<hr>
<p><strong>where子句</strong></p>
<p><strong>条件中可能出现的运算符</strong></p>
<ul>
<li><strong>比较运算符</strong>：&lt;，&gt;，&#x3D;，!&#x3D;（也写作&lt;&gt;），&lt;&#x3D;，&gt;&#x3D;</li>
<li><strong>逻辑运算符</strong>：and，or，not</li>
<li><strong>范围运算</strong>(下界&lt;上界)<ul>
<li>between 下界 and 上界</li>
<li>not between 下界 and 上界</li>
</ul>
</li>
<li><strong>集合运算</strong>：<ul>
<li>in 集合；</li>
<li>not in 集合</li>
</ul>
</li>
<li><strong>匹配运算</strong>：like 匹配串；not like 匹配串<ul>
<li>百分号%：匹配任一子串</li>
<li>下划线_：匹配任意一个字符<br>\是转义字符<br>例1：姓名 like ‘陈%’  【匹配：以“陈”开头的任意字符串】<br>例2：姓名 like ‘陈_’  【匹配：以“陈”开头，之后只有一个字符，且任意】<br>例3：内容 like ‘%100%正确%’   【匹配：<code>任意字符串</code>100%正确<code>任意字符串</code>】</li>
</ul>
</li>
</ul>
<p><strong>特别注意：因为选择运算(Where子句)在投影运算(Select子句)之前。所以Where子句中不能使用Select子句中更名后的新属性名</strong></p>
<p>错误的</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span>  姓名, <span class="number">2020</span>－年龄 <span class="keyword">as</span> 出生年份　</span><br><span class="line"><span class="keyword">From</span>    S　</span><br><span class="line"><span class="keyword">Where</span>  出生年份<span class="operator">&lt;</span><span class="number">1987</span></span><br></pre></td></tr></table></figure></div>

<p>正确的</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span>  姓名, <span class="number">2020</span>－年龄 <span class="keyword">as</span> 出生年份　</span><br><span class="line"><span class="keyword">From</span>    S　</span><br><span class="line"><span class="keyword">Where</span>  <span class="number">2020</span>－年龄<span class="operator">&lt;</span><span class="number">1987</span></span><br></pre></td></tr></table></figure></div>

<hr>
<p><strong>from子句</strong></p>
<p><strong>from子句中关系的重命名</strong>：旧关系名 [as] 新关系名<br>等价于更名运算。一个关系在From子句中多次出现时，从第二次开始必须重命名。关系重命名后，<strong>Select和Where子句中的前缀是使用新的关系名</strong></p>
<p>比如</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> S.姓名　</span><br><span class="line"><span class="keyword">From</span> R, R  <span class="keyword">as</span>  S</span><br><span class="line"><span class="keyword">Where</span> R.课程<span class="operator">=</span>“物理” <span class="keyword">and</span> R.姓名<span class="operator">=</span>“王红” </span><br><span class="line"><span class="keyword">and</span> S.课程<span class="operator">=</span>“物理” <span class="keyword">and</span> R.成绩 <span class="operator">&lt;</span> S.成绩</span><br></pre></td></tr></table></figure></div>

<h3 id="集合运算"><a href="#集合运算" class="headerlink" title="集合运算"></a>集合运算</h3><p>提前声明</p>
<blockquote>
<p>虽然SQL标准中支持Intersect和Except，但并非所有DBMS产品都提供这两种运算符。对于没有提供的DBMS，若要实现差运算或交运算，应使用exist&#x2F;in和not exist&#x2F;not in形式的嵌套子查询</p>
</blockquote>
<p>多个Select查询语句的结果可用集合运算进行交&#x2F;并&#x2F;差，<strong>语法如下</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SQL</span>查询<span class="number">1</span></span><br><span class="line"><span class="keyword">Union</span><span class="operator">/</span><span class="keyword">Intersect</span><span class="operator">/</span><span class="keyword">Except</span> [<span class="keyword">all</span>]</span><br><span class="line"><span class="keyword">SQL</span>查询<span class="number">2</span></span><br><span class="line"><span class="keyword">Union</span><span class="operator">/</span><span class="keyword">Intersect</span><span class="operator">/</span><span class="keyword">Except</span> [<span class="keyword">all</span>]</span><br><span class="line"><span class="keyword">SQL</span>查询<span class="number">3</span></span><br><span class="line">……  </span><br></pre></td></tr></table></figure></div>

<ul>
<li>Union: 并运算;  Intersect: 交运算; Except: 差运算。</li>
<li>参与集合运算的表的<strong>表结构要相同</strong></li>
<li>select不会自动去重，但<strong>集合运算会自动去重</strong>。如果不想去重，需要加上参数all：<code>union all</code>，<code>intersect all</code>，<code>except all</code></li>
</ul>
<p><strong>重复元组的处理举例</strong>：两个查询A和B，如果一个元组在A中出现a次，在B中出现b次，那么这个元组：</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">union</span> B           中出现<span class="number">1</span>次</span><br><span class="line">A <span class="keyword">intersect</span> B       中出现<span class="number">1</span>次</span><br><span class="line">A <span class="keyword">except</span> B          中出现<span class="number">1</span>次(a<span class="operator">&gt;</span>b)或<span class="number">0</span>次(a<span class="operator">&lt;=</span>b)</span><br><span class="line">A <span class="keyword">union</span> <span class="keyword">all</span> B       中出现a<span class="operator">+</span>b次</span><br><span class="line">A <span class="keyword">intersect</span> <span class="keyword">all</span> B   中出现<span class="built_in">Min</span>(a, b)次</span><br><span class="line">A <span class="keyword">except</span> <span class="keyword">all</span> B      中出现a－b次(a<span class="operator">&gt;</span>b)或<span class="number">0</span>次(a<span class="operator">&lt;=</span>b)</span><br></pre></td></tr></table></figure></div>

<h3 id="聚集函数"><a href="#聚集函数" class="headerlink" title="聚集函数"></a>聚集函数</h3><p>涉及到的子句：聚集函数，group by子句，having子句，order by子句</p>
<p>总览</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> A1 , A2 , … , An　　　　　　</span><br><span class="line"><span class="keyword">From</span> R1 , R2 , … , Rm</span><br><span class="line">[<span class="keyword">Where</span> 元组限定条件P]</span><br><span class="line">[<span class="keyword">Group</span> <span class="keyword">By</span> 属性<span class="number">1</span>, 属性<span class="number">2</span>, … 　　</span><br><span class="line">[<span class="keyword">Having</span> 分组限定条件Q]]　</span><br><span class="line">[<span class="keyword">Order</span> <span class="keyword">By</span> 属性<span class="number">1</span> [<span class="keyword">asc</span>｜<span class="keyword">desc</span>], 属性<span class="number">2</span> [<span class="keyword">asc</span>｜<span class="keyword">desc</span>], … ]</span><br></pre></td></tr></table></figure></div>

<p><strong>语义次序</strong>：From (笛卡儿积) → [ Where (选择) ] → [ Group By (分组) ] → [ Having (限定分组) ] → [ Select (投影, 或统计) ] → [ Order By (结果排序) ] </p>
<p><strong>Where子句</strong>中的条件用于<strong>限定元组</strong>，施加在单个元组上，不满足条件的元组将不会参与到下一步的分组运算(Group By子句)或投影运算(Select 子句)等</p>
<p><strong>Having子句</strong>中的条件用于<strong>限定Group By子句产生的各个分组</strong>，施加在整个分组上不满足条件的分组，将不会参与下一步的统计运算(Select子句)</p>
<hr>
<p><strong>group by 子句</strong></p>
<p>Group By子句的作用：对Where子句筛选出的元组，按指定的分组属性进行分组【<strong>分组属性相等的元组分为一组</strong>】<br>同时Select 子句的作用发生变化：对分组进行统计，每个分组在结果中被统计为一个元组</p>
<p><strong>格式</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> A1 , A2 , … , An　　　　　</span><br><span class="line"><span class="keyword">From</span> R1 , R2 , … , Rm　　　　　　　    </span><br><span class="line">[<span class="keyword">Where</span> P]</span><br><span class="line"><span class="keyword">Group</span> <span class="keyword">By</span> 属性<span class="number">1</span>, 属性<span class="number">2</span>, … 　　</span><br></pre></td></tr></table></figure></div>

<p><strong>select子句出现的属性只能是</strong>：<br>① group by 中出现的属性，即分组属性<br>② 聚集函数<br>③ 由①和②组成的表达式</p>
<p><strong>举例</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>查询每门课程的平均和最高成绩</span><br><span class="line"><span class="keyword">Select</span> 课程, <span class="built_in">Avg</span>(成绩) <span class="keyword">as</span> 平均成绩, <span class="built_in">Max</span>(成绩) <span class="keyword">as</span> 最高成绩　</span><br><span class="line"><span class="keyword">From</span> R</span><br><span class="line"><span class="keyword">Group</span> <span class="keyword">By</span> 课程 </span><br></pre></td></tr></table></figure></div>

<hr>
<p><strong>having子句</strong></p>
<p>Having子句<strong>只能配合Group By子句</strong>使用，而<strong>不能单独出现</strong><br>Having子句作用：在分组后，筛选满足条件Q的分组。<strong>不满足having条件的gruop by分组将被丢弃</strong></p>
<p><strong>格式</strong>(出现在group by子句后面)</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> A1 , A2 , … , An　　　　　　　</span><br><span class="line"><span class="keyword">From</span> R1,R2,…,Rm　　　　　　　   </span><br><span class="line"><span class="keyword">Where</span> P (元组限定条件)</span><br><span class="line"><span class="keyword">Group</span> <span class="keyword">By</span> 属性<span class="number">1</span>, 属性<span class="number">2</span>, … 　　</span><br><span class="line"><span class="keyword">Having</span> Q (分组限定条件) 　　</span><br></pre></td></tr></table></figure></div>

<p><strong>having子句中出现的属性只能是</strong>：<br>① group by 中出现的属性，即分组属性<br>② 聚集函数(任意属性)</p>
<p><strong>举例</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>查询平均成绩大于<span class="number">85</span>的学生姓名</span><br><span class="line"><span class="keyword">Select</span> 姓名</span><br><span class="line"><span class="keyword">From</span> R</span><br><span class="line"><span class="keyword">Group</span> <span class="keyword">By</span> 姓名 </span><br><span class="line"><span class="keyword">Having</span> <span class="built_in">Avg</span>(成绩) <span class="operator">&gt;</span> <span class="number">85</span></span><br></pre></td></tr></table></figure></div>

<hr>
<p><strong>order by 子句</strong></p>
<p>Order By子句的作用：在Select子句得出结果后，<strong>对结果进行排序</strong><br>先按属性1的值，升序(<code>asc</code>)或降序(<code>desc</code>)排列，**缺省是升序<code>asc</code>**；属性1的值相同时，再按属性2值升序或降序排列…</p>
<p><strong>举例</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>从高到低列出物理课程的成绩，再按如果同分，按学号升序排序</span><br><span class="line"><span class="keyword">Select</span> 学号, 姓名, 成绩</span><br><span class="line"><span class="keyword">From</span> S</span><br><span class="line"><span class="keyword">Where</span> 课程 <span class="operator">=</span> “物理” </span><br><span class="line"><span class="keyword">Order</span> <span class="keyword">By</span> 成绩 <span class="keyword">desc</span>, 学号 <span class="keyword">asc</span></span><br></pre></td></tr></table></figure></div>

<h3 id="空值处理"><a href="#空值处理" class="headerlink" title="空值处理"></a>空值处理</h3><p>空值null代表值未知&#x2F;值不存在</p>
<p><strong>判断空值</strong>： <code>A is [not] null</code>，不能用&#x3D;或!&#x3D;（结果为unknown）</p>
<p><strong>空值参与运算</strong></p>
<ul>
<li><strong>null参与算数运算</strong>：结果都是null</li>
<li><strong>null参与比较运算</strong>：结果是unknown</li>
<li><strong>null参与布尔运算，会被当成unknown，优先级如下</strong><ul>
<li>and：false &gt; unknown &gt; true</li>
<li>or：true &gt; unknown &gt; false</li>
<li>not：not unknown 结果还是unknown</li>
</ul>
</li>
<li><strong>null参与聚集运算</strong>：除了count(*)之外，其余聚集函数都忽略null</li>
</ul>
<h3 id="连接关系"><a href="#连接关系" class="headerlink" title="连接关系"></a>连接关系</h3><p>From子句中的两个相邻关系之间</p>
<ul>
<li>逗号分隔 —— 表示做笛卡尔积; </li>
<li>连接操作 —— 表示将它们连接成一个新的关系</li>
</ul>
<p>连接操作由连接类型和连接条件组成</p>
<p><strong>连接类型</strong></p>
<ul>
<li><code>inner join</code> : 内连接。结果不包含失配元组(失配元组指的是因不满足连接条件，无法和其它元组相连接的元组)</li>
<li><code>left (outer) join</code>: 左外连接。结果包含左边关系的失配元组</li>
<li><code>right (outer) join</code>: 右外连接。结果包含右边关系的失配元组</li>
<li><code>full (outer) join</code>: 全外连接。结果包含两边关系的失配元组</li>
<li><code>cross join</code>: 笛卡儿积 例子</li>
<li><code>union join</code></li>
</ul>
<p><strong>连接条件</strong></p>
<ul>
<li><code>natural</code>: 连接两边元组条件为同名属性相等（自然连接）</li>
<li><code>using (属性1, 属性2, …)</code>: 类似自然连接，但是只限于列出的的属性相等</li>
<li><code>on 条件</code>: 按照指定的条件连接两边元组</li>
</ul>
<p><strong>例子（就是看用法，意思不管）</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Emp.姓名, Dept.名称 <span class="keyword">as</span> 部门</span><br><span class="line"><span class="keyword">From</span> Emp <span class="keyword">inner</span> <span class="keyword">join</span> Dept <span class="keyword">on</span> Emp.部门号＝Dept.部门号</span><br><span class="line"></span><br><span class="line"><span class="keyword">Select</span> Emp.姓名, Dept.名称 <span class="keyword">as</span> 部门</span><br><span class="line"><span class="keyword">From</span> Emp <span class="keyword">inner</span> <span class="keyword">join</span> Dept <span class="keyword">using</span> (部门号)</span><br><span class="line"></span><br><span class="line"><span class="keyword">Select</span> Emp.姓名, Dept.名称 <span class="keyword">as</span> 部门</span><br><span class="line"><span class="keyword">From</span> Emp <span class="keyword">natural</span> <span class="keyword">inner</span> <span class="keyword">join</span> Dept</span><br><span class="line"></span><br><span class="line"><span class="keyword">Select</span> Emp.姓名, Dept.名称 <span class="keyword">as</span> 部门</span><br><span class="line"><span class="keyword">From</span> Emp <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> Dept <span class="keyword">on</span> Emp.部门号<span class="operator">=</span>Dept.部门号</span><br><span class="line"></span><br><span class="line"><span class="keyword">Select</span> Emp.姓名, Dept.名称 <span class="keyword">as</span> 部门</span><br><span class="line"><span class="keyword">From</span> Emp <span class="keyword">natural</span> <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> Dept</span><br><span class="line"></span><br><span class="line"><span class="keyword">Select</span> Emp.姓名, Dept.名称 <span class="keyword">as</span> 部门</span><br><span class="line"><span class="keyword">From</span> Emp <span class="keyword">full</span> <span class="keyword">outer</span> <span class="keyword">join</span> Dept <span class="keyword">using</span> (部门号)</span><br></pre></td></tr></table></figure></div>

<h3 id="嵌套子查询"><a href="#嵌套子查询" class="headerlink" title="嵌套子查询"></a>嵌套子查询</h3><h4 id="where中嵌套子查询"><a href="#where中嵌套子查询" class="headerlink" title="where中嵌套子查询"></a>where中嵌套子查询</h4><p>where子句中用子查询构造条件</p>
<hr>
<p>用法一：<strong>检查集合成员资格</strong></p>
<p><em>集合差except不支持的话，就可以用not in代替（用法三的not exists也可以代替）</em></p>
<p><strong>格式</strong>：<code>字段 in/ not in 集合</code></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A [<span class="keyword">not</span>] <span class="keyword">in</span> (子查询)</span><br></pre></td></tr></table></figure></div>

<p><strong>要求</strong><br>A可以是一个属性，也可以是一个属性集，但必须和子查询结果集的属性集一致</p>
<p><strong>结果</strong><br>当A是子查询结果中的一个值时，结果为真。否则为假</p>
<p><strong>举例</strong>: 查询没有选修数学的学生姓名</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> 姓名</span><br><span class="line"><span class="keyword">From</span> R</span><br><span class="line"><span class="keyword">Where</span> 姓名 <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">Select</span> 姓名 <span class="keyword">From</span> RWhere 课程<span class="operator">=</span>“数学” ) </span><br></pre></td></tr></table></figure></div>

<hr>
<p>用法二：<strong>集合比较</strong></p>
<p><strong>格式</strong>：<code>字段 比较运算符 som/all/any 集合</code></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A (比较运算, <span class="operator">&gt;</span>, <span class="operator">&lt;</span>, <span class="operator">=</span>,…)  <span class="keyword">some</span><span class="operator">|</span><span class="keyword">all</span> (子查询)</span><br></pre></td></tr></table></figure></div>

<p><strong>要求</strong><br>A可以是一个属性，也可以是一个属性集，但必须和子查询结果集的属性集一致</p>
<p><strong>结果</strong></p>
<ul>
<li>some：有一个满足就为true</li>
<li>all：全部满足才为true</li>
</ul>
<p><strong>特别说明</strong></p>
<ul>
<li><code>=some</code>等价于<code>in</code>，<code>&lt;&gt;some</code>不等价于<code>not in</code></li>
<li><code>&lt;&gt;all</code>等价于<code>not in</code>，<code>=all</code>不等价于<code>in</code></li>
</ul>
<p><strong>举例</strong>：查询物理课哪个学生的成绩最高</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> 姓名, 成绩 <span class="keyword">as</span> 最高物理成绩</span><br><span class="line"><span class="keyword">From</span> R</span><br><span class="line"><span class="keyword">Where</span> 课程＝“物理” <span class="keyword">and</span> 成绩 <span class="operator">&gt;=</span> <span class="keyword">all</span> (<span class="keyword">Select</span> 成绩 <span class="keyword">From</span> R <span class="keyword">Where</span> 课程<span class="operator">=</span>“物理”) </span><br></pre></td></tr></table></figure></div>

<hr>
<p>用法三：<strong>判断查询结果是否为空</strong></p>
<p><strong>格式</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">not</span>] <span class="keyword">exists</span> (子查询)</span><br></pre></td></tr></table></figure></div>

<p><strong>要点</strong></p>
<ul>
<li>子查询可包含多个属性(因为它不必和某个值做比较)</li>
<li>允许<strong>相关子查询</strong>，可引用外层查询关系的属性(最好标明关系前缀)。这一点对于in、some、all操作来说也是适用的</li>
</ul>
<p><strong>结果</strong><br>当子查询的结果不为空（包含任何记录）时，exists的结果为真。否则为假</p>
<p><strong>举例</strong>：查询哪个学生没有选修任何课程，列出姓名和年龄</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>使用<span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line"><span class="keyword">Select</span> 姓名, 年龄</span><br><span class="line"><span class="keyword">From</span> S</span><br><span class="line"><span class="keyword">Where</span> 姓名 <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">Select</span> 姓名 <span class="keyword">From</span> R) </span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>转换成使用<span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line"><span class="keyword">Select</span> 姓名, 年龄</span><br><span class="line"><span class="keyword">From</span> S</span><br><span class="line"><span class="keyword">Where</span> <span class="keyword">not</span> <span class="keyword">exists</span> (<span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">From</span> R <span class="keyword">Where</span> R.姓名<span class="operator">=</span>S.姓名) </span><br></pre></td></tr></table></figure></div>

<hr>
<h4 id="from中嵌套子查询"><a href="#from中嵌套子查询" class="headerlink" title="from中嵌套子查询"></a>from中嵌套子查询</h4><p>在From子句中，允许用<strong>子查询构造新的关系</strong>，称为派生关系。新<strong>关系必须命名</strong>，其属性也可以重命名</p>
<p><strong>派生关系的作用</strong>：允许用户在上一个查询的基础上，进一步查询，从而“一步步”地完成复杂的查询。</p>
<p><strong>格式</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">From</span> … , (<span class="keyword">SQL</span> 子查询) <span class="keyword">as</span> 关系名… , </span><br><span class="line"><span class="keyword">From</span> … , (<span class="keyword">SQL</span>子查询) <span class="keyword">as</span> 关系名(属性<span class="number">1</span>, 属性<span class="number">2</span>…) , </span><br></pre></td></tr></table></figure></div>

<p><strong>举例</strong>：查询每门课程的最高成绩和相应学生姓名</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> 课程, 姓名, 最高成绩 　</span><br><span class="line"><span class="keyword">From</span> R, (<span class="keyword">Select</span>  课程, <span class="built_in">Max</span>(成绩) <span class="keyword">as</span> 最高成绩 <span class="keyword">From</span>  R <span class="keyword">Group</span> <span class="keyword">By</span> 课程 ) <span class="keyword">as</span> S</span><br><span class="line"><span class="keyword">Where</span> R.成绩<span class="operator">=</span>S.最高成绩</span><br><span class="line"><span class="keyword">and</span> R.课程<span class="operator">=</span>S.课程</span><br></pre></td></tr></table></figure></div>

<h2 id="增删改"><a href="#增删改" class="headerlink" title="增删改"></a>增删改</h2><hr>
<p><strong>insert子句插入</strong></p>
<ul>
<li>如果没有列出插入的属性，默认values()里要一一对应表中所有的列</li>
<li>所列值的个数必须和属性的个数相等，且一一对应</li>
<li>对没有指定的属性填入缺省值（Create Table时定义），没有缺省值时填入空值</li>
</ul>
<p><strong>插入一个元组</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Insert</span> <span class="keyword">Into</span> 关系 [(属性<span class="number">1</span>, 属性<span class="number">2</span>, …)] <span class="keyword">Values</span> (值<span class="number">1</span>, 值<span class="number">2</span> , … )</span><br></pre></td></tr></table></figure></div>

<p><strong>插入多个元组（1个sql查询的结果）</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*查询结果的各个属性赋值给前面的属性，</span></span><br><span class="line"><span class="comment">所以要一一对应：类型相容，属性名可不同*/</span></span><br><span class="line"><span class="keyword">Insert</span> <span class="keyword">Into</span> 关系 [(属性<span class="number">1</span>, 属性<span class="number">2</span>, …)] <span class="keyword">Select</span> ……</span><br></pre></td></tr></table></figure></div>

<p>举例：添加所有学生选修数学课程的信息</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Insert</span> <span class="keyword">Into</span> R(姓名, 课程) </span><br><span class="line"><span class="keyword">Select</span>  姓名，课程  <span class="keyword">From</span> S, C <span class="keyword">Where</span> 课程<span class="operator">=</span>“数学”</span><br></pre></td></tr></table></figure></div>

<hr>
<p><strong>delete子句删除</strong></p>
<p>在关系中找到满足条件的元组，并删除之<br>如果没有Where子句，表示删除关系的全部元组(保留结构)<br>一次只能删除一个关系中的元组</p>
<p><strong>格式</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Delete</span> <span class="keyword">From</span> 关系 [<span class="keyword">Where</span>  条件]</span><br></pre></td></tr></table></figure></div>

<p>举例：删除平均分不及格的学生的选修信息</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Delete</span> <span class="keyword">From</span> R <span class="keyword">Where</span> 姓名 <span class="keyword">in</span></span><br><span class="line">(<span class="keyword">select</span> 姓名 <span class="keyword">from</span> R </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> 姓名 </span><br><span class="line"><span class="keyword">having</span> <span class="built_in">avg</span>(成绩) <span class="operator">&lt;</span> <span class="number">60</span>)</span><br></pre></td></tr></table></figure></div>

<hr>
<p><strong>update子句更新</strong></p>
<p>在关系中找到满足条件的元组，然后更新：表达式1的值赋予属性1；表达式2的值赋予属性2……<br>没有Where子句时，则对关系的全部元组都要更新</p>
<p><strong>格式</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Update</span> 关系 <span class="keyword">Set</span> 属性<span class="number">1</span> <span class="operator">=</span> 表达式<span class="number">1</span></span><br><span class="line">[,属性<span class="number">2</span> <span class="operator">=</span> 表达式<span class="number">2</span>]</span><br><span class="line">……</span><br><span class="line">[<span class="keyword">Where</span>  条件]</span><br></pre></td></tr></table></figure></div>

<p>举例：在原有的学生关系S里面增加”选修课程数”属性，然后填充正确的数值。</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Update</span> S <span class="keyword">set</span> 选修课程数 <span class="operator">=</span> </span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">count</span>(课程) <span class="keyword">from</span> R <span class="keyword">where</span> R.姓名<span class="operator">=</span>S.姓名 )</span><br></pre></td></tr></table></figure></div>

<h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><h2 id="视图的概念"><a href="#视图的概念" class="headerlink" title="视图的概念"></a>视图的概念</h2><p><strong>视图的本质</strong>：有名字的查询，而非一个表<br>一个视图总是对应一个select查询，且有唯一的名字（视图名）<br>查询中使用到的关系，称为基础关系。视图就是定义在基础关系上的。</p>
<p>视图的表象：<strong>“虚拟”关系</strong><br>用户访问视图时，看到的是一个<code>基础关系+查询</code>所派生 (计算) 出来的“虚拟”关系</p>
<ul>
<li>关系（的元组）是实际存在的，即是存储在数据库中的</li>
<li>视图（的元组）并不实际存在，而是通过查询“算”出来。每一次访问视图，都要通过查询“算”一次，以获得最新的内容。【数据库存的是视图的定义，而非其执行结果】</li>
<li>在增删改查操作中都可以使用视图，就像使用一个真正的关系一样。</li>
</ul>
<p><strong>注意</strong></p>
<ul>
<li>当基础关系发生变化后，再去访问视图，看到的虚拟关系也会发生相应的变化。</li>
<li>用户<strong>对视图的查询</strong>，系统在执行时必须<strong>转化为对基础关系的查询</strong>。</li>
<li>用户<strong>对视图的修改</strong>，系统在执行时必须<strong>转化为对基础关系的修改</strong>。</li>
</ul>
<h2 id="视图优点"><a href="#视图优点" class="headerlink" title="视图优点"></a>视图优点</h2><p><strong>简化用户的操作</strong><br>当经常进行某一复杂查询时，可将其固定的部分定义为一个视图，再用这个视图来重写查询，从而得到简化</p>
<p><strong>对于同一数据，不同用户可以从不同角度观察</strong><br>一个关系中，不同的用户可能关注不同的部分(不同的行&#x2F;列)，我们把这些部分定义成不同的视图，分配给不同用户。<br>表面上看，这些视图是内容不一样的“关系”。实际上，它们源自相同的基础关系，也不占用实际的存储空间。</p>
<p><strong>增强安全性</strong><br>“知必所需”，用视图来限制用户数据的访问范围。<br>例如，在为用户定义视图时，通过选择和投影操作限制用户只能访问数据库关系中的某些行和某些列</p>
<p><strong>提供模式（逻辑模式）&#x2F;外模式（子模式）映射和逻辑独立性</strong><br>关系属于模式（逻辑模式），视图属于外模式（子模式）。<br>在关系上定义视图相当于定义了模式&#x2F;外模式映射。用户&#x2F;应用程序看到的应该是子模式（视图）<br>当关系发生变化，例如增加了新字段时，视图不一定变化。也就是说，逻辑模式发生变化时，子模式不一定变化；子模式不变化时，用户程序也不变化。这就提供了数据逻辑独立性</p>
<h2 id="定义视图"><a href="#定义视图" class="headerlink" title="定义视图"></a>定义视图</h2><p><strong>创建视图</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> 视图名 [( 属性名 &#123;, 属性名&#125; )] <span class="keyword">as</span> (查询语句) [<span class="keyword">with</span> <span class="keyword">check</span> option]</span><br></pre></td></tr></table></figure></div>
<ul>
<li>视图的属性可以显式命名，也可缺省取查询结果中的属性名</li>
<li><code>with check option</code>: 当对视图进行插入，更新时，要检查新元组是否满足视图对应查询的条件。不满足则无法超过操作。</li>
<li>定义视图时，可以在相应查询中使用其它视图</li>
</ul>
<p>举例</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>对视图Class1插入<span class="number">2</span>班的学生是不能成功的</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> Class1(sno, name, sex, class) <span class="keyword">as</span> </span><br><span class="line">(<span class="keyword">Select</span> 学号, 姓名, 性别, 班级 <span class="keyword">From</span> S <span class="keyword">Where</span> 班级 <span class="operator">=</span> &quot;1班&quot;) </span><br><span class="line"><span class="keyword">with</span> <span class="keyword">check</span> option</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>定义视图时，可以在相应查询中使用其它视图</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">View</span> Class1_male <span class="keyword">as</span>   </span><br><span class="line"><span class="keyword">Select</span> 学号, 姓名 <span class="keyword">From</span> Class1 <span class="keyword">Where</span> 性别<span class="operator">=</span>‘男’</span><br></pre></td></tr></table></figure></div>

<p><strong>删除视图</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> 视图名</span><br></pre></td></tr></table></figure></div>

<h2 id="查询视图"><a href="#查询视图" class="headerlink" title="查询视图"></a>查询视图</h2><p>对视图的查询，语法上和对关系的查询是一样的，但是系统在查询时作的工作不一样</p>
<p>涉及视图的查询，系统必须 “展开” 视图，既用对应的定义（查询语句）代替视图本身，如果仍有视图，则继续展开，直到查询语句中没有视图。</p>
<h2 id="修改视图"><a href="#修改视图" class="headerlink" title="修改视图"></a>修改视图</h2><p>对视图的增删改查和基础关系相同。即在Insert、Delete、Update语句中，直接使用视图（代替关系）即可。</p>
<p>但是<strong>视图的修改是受限的</strong>：视图是一个不存在的“虚拟”关系，对视图的修改要转化为对基础关系的修改。这种转化不一定成功，导致并非所有视图都能被修改。</p>
<p><strong>修改失败的情况</strong></p>
<ul>
<li><p><strong>情况一：信息缺失</strong>：如果<strong>视图定义不包括基础关系的主码</strong>，则在对视图的修改转化为对基础关系的修改时，往往会因为缺乏主码值而无法完成。</p>
</li>
<li><p><strong>情况二：信息歧义</strong></p>
<ul>
<li>当一个<strong>视图是来自对多个基础关系的查询</strong>时，无法决定将对视图的修改转化为对哪个基础关系的修改</li>
<li>当视图的一个元组是“来自”关系里面的多个元组时【比如count(*)】，同样修改无法转化</li>
</ul>
</li>
</ul>
<p><strong>无法修改的情况总结为</strong></p>
<blockquote>
<p>（查询的）Select 子句不包括主码<br>Select 子句中用聚集函数或算术表达式构造的新属性<br>Select 子句存在distinct关键字<br>From 子句中有多个关系<br>有Group By子句</p>
</blockquote>
<p><strong>同时满足以下条件，视图才是可修改的</strong></p>
<ul>
<li>Select 子句中包含主码</li>
<li>Select 子句中只出现原有属性，而没有用聚集函数或算术表达式构造的新属性</li>
<li>Select 子句中无distinct关键字</li>
<li>From 子句中只有一个关系</li>
<li>无Group By子句</li>
</ul>
<h2 id="物化视图"><a href="#物化视图" class="headerlink" title="物化视图"></a>物化视图</h2><p><strong>物化视图</strong><br>某些数据库系统允许将某一时刻视图的内容（对应查询的结果关系）保存起来，得到一个“快照” ，称为物化视图。</p>
<p><strong>创建物化视图</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> materialized <span class="keyword">view</span> 物化视图名 <span class="keyword">as</span> (查询语句)</span><br></pre></td></tr></table></figure></div>

<p><strong>一般视图 vs 物化视图</strong><br><code>一般视图</code>是访问的时候才用查询算出来，是一个“虚拟”的关系。<strong>并不真正地占用存储空间</strong>。</p>
<ul>
<li>优点：我们看到的<strong>视图永远是“最新”</strong>的，反映基础关系的最近变化。因此不<strong>用特意考虑视图与基础关系间的“同步”</strong></li>
<li>缺点：每次使用视图，都要<strong>重新“计算”一遍</strong>，付出相应的开销</li>
</ul>
<p><code>物化视图</code>是将某一时刻对应的查询结果保存起来。<strong>需要占用存储空间</strong>。</p>
<ul>
<li>优点：访问物化视图时，<strong>不用再“算”了</strong>，直接取出预先存储好的数据即可，提高查询效率</li>
<li>缺点：<strong>基础关系变化以后，必须修改物化视图以同步反映这一变化</strong>。当然，延长多久来做这种修改，取决与你可以容忍物化视图的内容有多“过时”</li>
</ul>
<p><strong>物化视图的应用场合</strong></p>
<ul>
<li>频繁地对视图进行查询，并且基础关系很少变化，所以视图的内容也很少变化。即<strong>读的频率远远高于写</strong>。用物化视图可以减少计算量</li>
<li>或者即使基础关系变化了，也<strong>允许“看到”的视图内容有一定的延迟</strong>。</li>
</ul>

            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li>Post title：SQL语言</li>
        <li>Post author：萧</li>
        <li>Create time：2023-06-19 22:00:50</li>
        <li>
            Post link：https://redefine.ohevan.com/2023/06/19/数据库笔记/SQL语言/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA/">#数据库理论</a>&nbsp;
                        </li>
                    
                </ul>
            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                            rel="prev"
                            href="/2023/07/02/%E8%BF%90%E7%BB%B4/%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE%E6%96%B9%E6%B3%95/"
                            >
                                <span class="left arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </span>
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">最基本的部署项目方法</span>
                                    <span class="post-nav-item">Prev posts</span>
                                </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/2023/06/19/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">关系模型</span>
                                    <span class="post-nav-item">Next posts</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            

            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div style="font-size: 1.3rem;margin-top: 0; margin-bottom: 0.8rem; transition-duration: 0.1s;"><i class="fa-solid fa-list"></i> <strong>Contents</strong></div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL%E8%AF%AD%E8%A8%80%E5%88%86%E7%B1%BB"><span class="nav-text">SQL语言分类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DDL%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80"><span class="nav-text">DDL数据定义语言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DML%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E8%AF%AD%E8%A8%80"><span class="nav-text">DML数据操作语言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2"><span class="nav-text">查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="nav-text">简单查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97"><span class="nav-text">集合运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0"><span class="nav-text">聚集函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A9%BA%E5%80%BC%E5%A4%84%E7%90%86"><span class="nav-text">空值处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E5%85%B3%E7%B3%BB"><span class="nav-text">连接关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B5%8C%E5%A5%97%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">嵌套子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#where%E4%B8%AD%E5%B5%8C%E5%A5%97%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">where中嵌套子查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#from%E4%B8%AD%E5%B5%8C%E5%A5%97%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">from中嵌套子查询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="nav-text">增删改</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE"><span class="nav-text">视图</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">视图的概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E4%BC%98%E7%82%B9"><span class="nav-text">视图优点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BE"><span class="nav-text">定义视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E8%A7%86%E5%9B%BE"><span class="nav-text">查询视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE"><span class="nav-text">修改视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE"><span class="nav-text">物化视图</span></a></li></ol></li></ol>
    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>



        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2022</span>
              -
            
            2023&nbsp;<i class="fa-solid fa-heart icon-animate"></i>&nbsp;<a href="/">萧. All Rights Reserved.</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalviews&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v0.5.2</a>
        </div>
        
        
        <script async data-pjax defer>
            function odometer_init(){
                    let el = document.getElementsByClassName('odometer');
                    for (i = 0; i < el.length; i++) {
                        od = new Odometer({
                            el: el[i],
                            format: '( ddd).dd',
                            duration: 200
                        });
                    }
            }
            odometer_init();
        </script>
        <div id="start_time_div" style="display:none">
            2022/8/17 11:45:14
        </div>
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        

        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fa-solid fa-magnifying-glass-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fa-solid fa-magnifying-glass-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fa-solid fa-left-right"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fa-solid fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fa-solid fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fa-solid fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fa-solid fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>





    
<script src="/js/code-copy.js"></script>




    
<script src="/js/lazyload.js"></script>




    
<script src="/js/runtime.js"></script>

    
<script src="/js/odometer.min.js"></script>

    
<link rel="stylesheet" href="/css/odometer-theme-minimal.css">



<div class="post-scripts pjax">
    
        
<script src="/js/toc-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            REDEFINE.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            REDEFINE.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            REDEFINE.refresh();
        });
    });
</script>



</body>
</html>
